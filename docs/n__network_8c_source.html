<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Nilorea Library: n_network.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Nilorea Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('n__network_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">n_network.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="n__network_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/**\file n_network.c</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *  Network Engine</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *\author Castagnier Mickael</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *\version 1.0</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *\date 10/05/2005</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;pthread.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="n__network_8h.html">nilorea/n_network.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="n__network__msg_8h.html">nilorea/n_network_msg.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;nilorea/n_log.h&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="n__hash_8h.html">nilorea/n_hash.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="n__network_8c.html#a4647db7f861fc61c8449577ffe37fe26">   20</a></span>&#160;<a class="code" href="n__network_8c.html#a4647db7f861fc61c8449577ffe37fe26">N_ENUM_DEFINE</a>( N_ENUM_netw_code_type , __netw_code_type )</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#ifdef __windows__</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">                 * From https://stackoverflow.com/questions/3019977/convert-wchar-t-to-char/55715607#55715607 by Richard Bamford</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keywordtype">char</span>* wchar_to_char(<span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* pwchar)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                <span class="comment">// get the number of characters in the string.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                <span class="keywordtype">int</span> currentCharIndex = 0;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                <span class="keywordtype">char</span> currentChar = pwchar[currentCharIndex];</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                <span class="keywordtype">char</span> *filePathC = NULL ;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                <span class="keywordflow">while</span> (currentChar != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                                currentCharIndex++;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                currentChar = pwchar[currentCharIndex];</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> charCount = currentCharIndex + 1;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                <span class="comment">// allocate a new block of memory size char (1 byte) instead of wide char (2 bytes)</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( filePathC, <span class="keywordtype">char</span>, charCount );</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( filePathC, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; charCount; i++)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                <span class="comment">// convert to char (1 byte)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                <span class="keywordtype">char</span> character = pwchar[i];</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                *filePathC = character;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                filePathC += <span class="keyword">sizeof</span>(char);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                }</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                filePathC += <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                filePathC -= (<span class="keyword">sizeof</span>(char) * charCount);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                <span class="keywordflow">return</span> filePathC;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#define neterrno WSAGetLastError()</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#define netstrerror( code )({ \</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">                                wchar_t *s = NULL; \</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">                                FormatMessageW(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS, \</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">                                                                NULL, code , \</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">                                                                MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), \</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">                                                                (LPWSTR)&amp;s, 0, NULL); \</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">                                                                char *netstr = wchar_to_char( s ); \</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">                                                                LocalFree( s ); \</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">                                                                netstr ; \</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">                                                                })</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">/* if __GNUC__ &gt; 4 || (__GNUC__ == 4 &amp;&amp; __GNUC_MINOR__ &gt; 5) */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#if __GNUC__ &lt;= 6 &amp;&amp; __GNUC_MINOR__ &lt;= 3</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">/*--------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  By Marco Ladino - mladinox.. jan/2016</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">  MinGW 3.45 thru 4.5 versions, don&#39;t have the socket functions:</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">  --&gt; inet_ntop(..)</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">  --&gt; inet_pton(..)</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">  But with this adapted code using the original functions from FreeBSD,</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">  one can to use it in the C/C++ Applications, without problem..!</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">  This implementation, include tests for IPV4 and IPV6 addresses,</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">  and is full C/C++ compatible..</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">  --------------------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">/*              $OpenBSD: strlcpy.c,v 1.11 2006/05/05 15:27:38 millert Exp $    */</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">/*-</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> * Copyright (c) 1998 Todd C. Miller &lt;Todd.Miller@courtesan.com&gt;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> * Permission to use, copy, modify, and distribute this software for any</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> * purpose with or without fee is hereby granted, provided that the above</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> * copyright notice and this permission notice appear in all copies.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/cdefs.h&gt;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">//mladinox:: __FBSDID(&quot;$FreeBSD: stable/9/sys/libkern/strlcpy.c 243811 2012-12-03 18:08:44Z delphij $&quot;);</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/types.h&gt;</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/libkern.h&gt;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"> * Copy src to string dst of size siz.  At most siz-1 characters</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> * will be copied.  Always NUL terminates (unless siz == 0).</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> * Returns strlen(src); if retval &gt;= siz, truncation occurred.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">size_t</span> strlcpy(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">size_t</span> siz)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;{</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                <span class="keywordtype">char</span> *d = dst;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *s = src;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                <span class="keywordtype">size_t</span> n = siz;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="comment">/* Copy as many bytes as will fit */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">if</span> (n != 0)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                <span class="keywordflow">while</span> (--n != 0)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                                <span class="keywordflow">if</span> ((*d++ = *s++) == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="comment">/* Not enough room in dst, add NUL and traverse rest of src */</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">if</span> (n == 0)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                <span class="keywordflow">if</span> (siz != 0)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                                                *d = <span class="charliteral">&#39;\0&#39;</span>;                      <span class="comment">/* NUL-terminate dst */</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                <span class="keywordflow">while</span> (*s++)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                                ;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="keywordflow">return</span>(s - src - 1);            <span class="comment">/* count does not include NUL */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment"> * Copyright (c) 2004 by Internet Systems Consortium, Inc. (&quot;ISC&quot;)</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"> * Copyright (c) 1996-1999 by Internet Software Consortium.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"> * Permission to use, copy, modify, and distribute this software for any</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"> * purpose with or without fee is hereby granted, provided that the above</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"> * copyright notice and this permission notice appear in all copies.</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ISC DISCLAIMS ALL WARRANTIES</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"> * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"> * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">//mladinox:: #if defined(LIBC_SCCS) &amp;&amp; !defined(lint)</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">//mladinox:: static const char rcsid[] = &quot;$Id: inet_ntop.c,v 1.3.18.2 2005/11/03 23:02:22 marka Exp $&quot;;</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">//mladinox:: #endif /* LIBC_SCCS and not lint */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/cdefs.h&gt;</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">//mladinox:: __FBSDID(&quot;$FreeBSD: stable/9/sys/libkern/inet_ntop.c 213103 2010-09-24 15:01:45Z attilio $&quot;);</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/param.h&gt;</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/socket.h&gt;</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/systm.h&gt;</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">//mladinox:: #include &lt;netinet/in.h&gt;</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">/*%</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment"> * WARNING: Don&#39;t even consider trying to compile this on a system where</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment"> * sizeof(int) &lt; 4.  sizeof(int) &gt; 4 is fine; all the world&#39;s not a VAX.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span>     *inet_ntop4(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> *dst, socklen_t size);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span>     *inet_ntop6(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> *dst, socklen_t size);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">/* char *</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"> * inet_ntop(af, src, dst, size)</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"> *              convert a network format address to presentation format.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment"> * return:</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"> *              pointer to presentation format address (`dst&#39;), or NULL (see errno).</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"> * author:</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"> *              Paul Vixie, 1996.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordtype">char</span> *inet_ntop(<span class="keywordtype">int</span> af, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">char</span> *dst, socklen_t size)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                <span class="keywordflow">switch</span> (af)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                <span class="keywordflow">case</span> AF_INET:</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                                <span class="keywordflow">return</span> (inet_ntop4((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)src, dst, size));</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                <span class="keywordflow">case</span> AF_INET6:</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                                <span class="keywordflow">return</span> (inet_ntop6((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)src, dst, size));</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                                <span class="keywordflow">return</span> (NULL);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="comment">/* NOTREACHED */</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">/* const char *</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"> * inet_ntop4(src, dst, size)</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"> *              format an IPv4 address</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment"> * return:</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"> *              `dst&#39; (as a const)</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"> * notes:</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"> *              (1) uses no statics</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"> *              (2) takes a u_char* not an in_addr as input</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment"> * author:</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"> *              Paul Vixie, 1996.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *inet_ntop4(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> *dst, socklen_t size)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> fmt[] = <span class="stringliteral">&quot;%u.%u.%u.%u&quot;</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="keywordtype">char</span> tmp[<span class="keyword">sizeof</span> <span class="stringliteral">&quot;255.255.255.255&quot;</span>];</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordtype">int</span> l;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                l = snprintf(tmp, <span class="keyword">sizeof</span>(tmp), fmt, src[0], src[1], src[2], src[3]);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordflow">if</span> (l &lt;= 0 || (socklen_t) l &gt;= size)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                <span class="keywordflow">return</span> (NULL);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                strlcpy(dst, tmp, size);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordflow">return</span> (dst);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/* const char *</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> * inet_ntop6(src, dst, size)</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"> *              convert IPv6 binary address into presentation (printable) format</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"> * author:</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"> *              Paul Vixie, 1996.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *inet_ntop6(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> *dst, socklen_t size)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">                 * Note that int32_t and int16_t need only be &quot;at least&quot; large enough</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">                 * to contain a value of the specified size.  On some systems, like</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">                 * Crays, there is no such thing as an integer variable with 16 bits.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">                 * Keep this in mind if you think this function should have been coded</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">                 * to use pointer overlays.  All the world&#39;s not a VAX.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keywordtype">char</span> tmp[<span class="keyword">sizeof</span> <span class="stringliteral">&quot;ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255&quot;</span>], *tp;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keyword">struct</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                                <span class="keywordtype">int</span> base, len;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                } best, cur;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">#define NS_IN6ADDRSZ            16</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NS_INT16SZ              2</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="preprocessor"></span>                u_int words[NS_IN6ADDRSZ / NS_INT16SZ];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">                 * Preprocess:</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">                 *              Copy the input (bytewise) array into a wordwise array.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">                 *              Find the longest run of 0x00&#39;s in src[] for :: shorthanding.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                memset(words, <span class="charliteral">&#39;\0&#39;</span>, <span class="keyword">sizeof</span> words);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; NS_IN6ADDRSZ; i++)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                words[i / 2] |= (src[i] &lt;&lt; ((1 - (i % 2)) &lt;&lt; 3));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                best.base = -1;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                best.len = 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                cur.base = -1;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                cur.len = 0;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; (NS_IN6ADDRSZ / NS_INT16SZ); i++)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                                <span class="keywordflow">if</span> (words[i] == 0)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                                <span class="keywordflow">if</span> (cur.base == -1)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                                                cur.base = i, cur.len = 1;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                                                cur.len++;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                                <span class="keywordflow">if</span> (cur.base != -1)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                                {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                                <span class="keywordflow">if</span> (best.base == -1 || cur.len &gt; best.len)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                                                                best = cur;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                                                cur.base = -1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                                }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                }</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordflow">if</span> (cur.base != -1)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                <span class="keywordflow">if</span> (best.base == -1 || cur.len &gt; best.len)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                                best = cur;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">if</span> (best.base != -1 &amp;&amp; best.len &lt; 2)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                                best.base = -1;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">                 * Format the result.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                tp = tmp;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                <span class="keywordflow">for</span> (i = 0; i &lt; (NS_IN6ADDRSZ / NS_INT16SZ); i++)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                <span class="comment">/* Are we inside the best run of 0x00&#39;s? */</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                <span class="keywordflow">if</span> (best.base != -1 &amp;&amp; i &gt;= best.base &amp;&amp;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                                                i &lt; (best.base + best.len))</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                                <span class="keywordflow">if</span> (i == best.base)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                                                *tp++ = <span class="charliteral">&#39;:&#39;</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                <span class="comment">/* Are we following an initial run of 0x00s or any real hex? */</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                <span class="keywordflow">if</span> (i != 0)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                                *tp++ = <span class="charliteral">&#39;:&#39;</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                <span class="comment">/* Is this address an encapsulated IPv4? */</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                <span class="keywordflow">if</span> (i == 6 &amp;&amp; best.base == 0 &amp;&amp; (best.len == 6 ||</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                                                                (best.len == 7 &amp;&amp; words[7] != 0x0001) ||</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                                                                (best.len == 5 &amp;&amp; words[5] == 0xffff)))</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                                <span class="keywordflow">if</span> (!inet_ntop4(src+12, tp, <span class="keyword">sizeof</span> tmp - (tp - tmp)))</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                                                <span class="keywordflow">return</span> (NULL);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                                tp += strlen(tp);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                tp += sprintf(tp, <span class="stringliteral">&quot;%x&quot;</span>, words[i]);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="comment">/* Was it a trailing run of 0x00&#39;s? */</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                <span class="keywordflow">if</span> (best.base != -1 &amp;&amp; (best.base + best.len) ==</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                                (NS_IN6ADDRSZ / NS_INT16SZ))</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                *tp++ = <span class="charliteral">&#39;:&#39;</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                *tp++ = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">                 * Check for overflow, copy, and we&#39;re done.</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                <span class="keywordflow">if</span> ((socklen_t)(tp - tmp) &gt; size)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                <span class="keywordflow">return</span> (NULL);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                strcpy(dst, tmp);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">return</span> (dst);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">//----------------</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"> * Copyright (c) 2004 by Internet Systems Consortium, Inc. (&quot;ISC&quot;)</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment"> * Copyright (c) 1996,1999 by Internet Software Consortium.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"> * Permission to use, copy, modify, and distribute this software for any</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"> * purpose with or without fee is hereby granted, provided that the above</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"> * copyright notice and this permission notice appear in all copies.</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ISC DISCLAIMS ALL WARRANTIES</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">//mladinox:: #if defined(LIBC_SCCS) &amp;&amp; !defined(lint)</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">//mladinox:: static const char rcsid[] = &quot;$Id: inet_pton.c,v 1.3.18.2 2005/07/28 07:38:07 marka Exp $&quot;;</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">//mladinox:: #endif /* LIBC_SCCS and not lint */</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/cdefs.h&gt;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">//mladinox:: __FBSDID(&quot;$FreeBSD: stable/9/sys/libkern/inet_pton.c 213103 2010-09-24 15:01:45Z attilio $&quot;);</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/param.h&gt;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/socket.h&gt;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">//mladinox:: #include &lt;sys/systm.h&gt;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">//mladinox:: #include &lt;netinet/in.h&gt;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">//mladinox:: #if __FreeBSD_version &lt; 700000</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">//mladinox:: #define strchr index</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">//mladinox:: #endif</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/*%</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> * WARNING: Don&#39;t even consider trying to compile this on a system where</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> * sizeof(int) &lt; 4.  sizeof(int) &gt; 4 is fine; all the world&#39;s not a VAX.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span>      inet_pton4(<span class="keyword">const</span> <span class="keywordtype">char</span> *src, u_char *dst);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span>      inet_pton6(<span class="keyword">const</span> <span class="keywordtype">char</span> *src, u_char *dst);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">/* int</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"> * inet_pton(af, src, dst)</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment"> *              convert from presentation format (which usually means ASCII printable)</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"> *              to network format (which is usually some kind of binary format).</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment"> * return:</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment"> *              1 if the address was valid for the specified address family</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"> *              0 if the address wasn&#39;t valid (`dst&#39; is untouched in this case)</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment"> *              -1 if some other error occurred (`dst&#39; is untouched in this case, too)</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment"> * author:</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment"> *              Paul Vixie, 1996.</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordtype">int</span> inet_pton(<span class="keywordtype">int</span> af, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">void</span> *dst)</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;{</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="keywordflow">switch</span> (af)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                {</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                <span class="keywordflow">case</span> AF_INET:</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                                <span class="keywordflow">return</span> (inet_pton4(src, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)dst));</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                <span class="keywordflow">case</span> AF_INET6:</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                                <span class="keywordflow">return</span> (inet_pton6(src, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)dst));</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                                <span class="keywordflow">return</span> (-1);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <span class="comment">/* NOTREACHED */</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;}</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">/* int</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment"> * inet_pton4(src, dst)</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"> *              like inet_aton() but without all the hexadecimal and shorthand.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> * return:</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> *              1 if `src&#39; is a valid dotted quad, else 0.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> * notice:</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"> *              does not touch `dst&#39; unless it&#39;s returning 1.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment"> * author:</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> *              Paul Vixie, 1996.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> inet_pton4(<span class="keyword">const</span> <span class="keywordtype">char</span> *src, u_char *dst)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;{</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> digits[] = <span class="stringliteral">&quot;0123456789&quot;</span>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="keywordtype">int</span> saw_digit, octets, ch;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="preprocessor">#define NS_INADDRSZ             4</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor"></span>                u_char tmp[NS_INADDRSZ], *tp;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                saw_digit = 0;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                octets = 0;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                *(tp = tmp) = 0;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                <span class="keywordflow">while</span> ((ch = *src++) != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">char</span> *pch;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                <span class="keywordflow">if</span> ((pch = strchr(digits, ch)) != NULL)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                                u_int uiNew = *tp * 10 + (pch - digits);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                                <span class="keywordflow">if</span> (saw_digit &amp;&amp; *tp == 0)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                                                <span class="keywordflow">if</span> (uiNew &gt; 255)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                                                *tp = uiNew;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                                <span class="keywordflow">if</span> (!saw_digit)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                                                {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                                                                <span class="keywordflow">if</span> (++octets &gt; 4)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                                                saw_digit = 1;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                                }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                                }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; saw_digit)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                                {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                                <span class="keywordflow">if</span> (octets == 4)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                                *++tp = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                                saw_digit = 0;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="keywordflow">if</span> (octets &lt; 4)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                memcpy(dst, tmp, NS_INADDRSZ);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;}</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">/* int</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment"> * inet_pton6(src, dst)</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"> *              convert presentation level address to network order binary form.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment"> * return:</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"> *              1 if `src&#39; is a valid [RFC1884 2.2] address, else 0.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment"> * notice:</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment"> *              (1) does not touch `dst&#39; unless it&#39;s returning 1.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment"> *              (2) :: in a full address is silently ignored.</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment"> * credit:</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment"> *              inspired by Mark Andrews.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"> * author:</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"> *              Paul Vixie, 1996.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> inet_pton6(<span class="keyword">const</span> <span class="keywordtype">char</span> *src, u_char *dst)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;{</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> xdigits_l[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                                                 xdigits_u[] = <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="preprocessor">#define NS_IN6ADDRSZ            16</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define NS_INT16SZ              2</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="preprocessor"></span>                u_char tmp[NS_IN6ADDRSZ], *tp, *endp, *colonp;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *curtok;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                <span class="keywordtype">int</span> ch, seen_xdigits;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                u_int val;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                memset((tp = tmp), <span class="charliteral">&#39;\0&#39;</span>, NS_IN6ADDRSZ);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                endp = tp + NS_IN6ADDRSZ;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                colonp = NULL;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <span class="comment">/* Leading :: requires some special handling. */</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                <span class="keywordflow">if</span> (*++src != <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                curtok = src;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                seen_xdigits = 0;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                val = 0;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                <span class="keywordflow">while</span> ((ch = *src++) != <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">char</span> *xdigits :</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                                                <span class="keyword">const</span> <span class="keywordtype">char</span> *pch ;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                                <span class="keywordflow">if</span> ((pch = strchr((xdigits = xdigits_l), ch)) == NULL)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                                pch = strchr((xdigits = xdigits_u), ch);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                <span class="keywordflow">if</span> (pch != NULL)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                                                val &lt;&lt;= 4;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                                                val |= (pch - xdigits);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                                                <span class="keywordflow">if</span> (++seen_xdigits &gt; 4)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                                <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                                {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                                curtok = src;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                                <span class="keywordflow">if</span> (!seen_xdigits)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                                {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                                                <span class="keywordflow">if</span> (colonp)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                                                colonp = tp;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                                }</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*src == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                                {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                                                }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                                                <span class="keywordflow">if</span> (tp + NS_INT16SZ &gt; endp)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                                                *tp++ = (u_char) (val &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                                *tp++ = (u_char) val &amp; 0xff;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                                seen_xdigits = 0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                                val = 0;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; ((tp + NS_INADDRSZ) &lt;= endp) &amp;&amp;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                                                inet_pton4(curtok, tp) &gt; 0)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                                tp += NS_INADDRSZ;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                                seen_xdigits = 0;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                                <span class="keywordflow">break</span>;          <span class="comment">/*%&lt; &#39;\\0&#39; was seen by inet_pton4(). */</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="keywordflow">if</span> (seen_xdigits)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                <span class="keywordflow">if</span> (tp + NS_INT16SZ &gt; endp)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                *tp++ = (u_char) (val &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                *tp++ = (u_char) val &amp; 0xff;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                <span class="keywordflow">if</span> (colonp != NULL)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                <span class="comment">/*</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">                                 * Since some memmove()&#39;s erroneously fail to handle</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">                                 * overlapping regions, we&#39;ll do the shift by hand.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">                                 */</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">int</span> n = tp - colonp;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                                <span class="keywordflow">if</span> (tp == endp)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                <span class="keywordflow">for</span> (i = 1; i &lt;= n; i++)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                {</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                                endp[- i] = colonp[n - i];</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                                colonp[n - i] = 0;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                                }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                tp = endp;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                <span class="keywordflow">if</span> (tp != endp)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                <span class="keywordflow">return</span> (0);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                memcpy(dst, tmp, NS_IN6ADDRSZ);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                <span class="keywordflow">return</span> (1);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* if GCC_VERSION &lt;= 4.5 */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="preprocessor">#else </span><span class="comment">/* ifdef __windows__ */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">/*! Keep it compatible with bsd like */</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="preprocessor">#define neterrno errno</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor"></span><span class="comment">/*! BSD style errno string NO WORKING ON REDHAT */</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">/* #define netstrerror( code )({ \</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">   size_t errmsglen = 512 ; // strerrorlen_s( code ) + 1  ; \</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">   char *errmsg = NULL ; \</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">   Malloc( errmsg , char , errmsglen ); \</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">   if( errmsg ) \</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">   { \</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">   strerror_s( errmsg , errmsglen , code ); \</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">   } \</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">   errmsg ; \</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">   }) */</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="preprocessor">#define netstrerror( code )({ \</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor">                                char *errmsg = NULL ; \</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="preprocessor">                                errno = 0 ; \</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor">                                errmsg = strdup( strerror( code ) ); \</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">                                if( errno == ENOMEM ) \</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="preprocessor">                                { \</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor">                                errmsg = NULL ; \</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor">                                } \</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="preprocessor">                                errmsg ; \</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="preprocessor">                                })</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keywordtype">void</span> netw_sigchld_handler( <span class="keywordtype">int</span> sig )</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;{</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="comment">// waitpid() might overwrite errno, so we save and restore it:</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordtype">int</span> saved_errno = errno;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                <span class="keywordflow">while</span>(waitpid(-1, NULL, WNOHANG) &gt; 0);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                errno = saved_errno;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Signal %d&quot;</span>, sig );</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* ifndef windows */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">/*!\fn NETWORK *netw_new( int send_list_limit , int recv_list_limit )</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> *\brief Return an empty allocated network ready to be netw_closed</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"> *\param send_list_limit Thread engine number of tosend message limit</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment"> *\param recv_list_limit Thread engine number of received message limit</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"> *\return NULL or a new empty network</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00631"></a><span class="lineno"><a class="line" href="n__network_8c.html#a9caee75e3a67942e37ccb4de2c889105">  631</a></span>&#160;<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *<a class="code" href="n__network_8c.html#a9caee75e3a67942e37ccb4de2c889105">netw_new</a>( <span class="keywordtype">int</span> send_list_limit, <span class="keywordtype">int</span> recv_list_limit )</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;{</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw = NULL ;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( netw, <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a>, 1 );</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="comment">/* netw itself */</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                netw -&gt; nb_pending = -1 ;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                netw -&gt; mode = -1 ;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                netw -&gt; user_id = -1 ;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                netw -&gt; nb_running_threads = 0 ;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                netw -&gt; state = NETW_EXITED ;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                netw -&gt; threaded_engine_status = NETW_THR_ENGINE_STOPPED ;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                <span class="comment">/* netw -&gt; link */</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                netw -&gt; link . sock = -1 ;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                netw -&gt; link . port =</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                netw -&gt; link . ip = NULL ;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                memset( &amp;netw -&gt; link . hints, 0, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> addrinfo ) );</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                memset( &amp;netw -&gt; link . raddr, 0, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> sockaddr_storage ) );</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="comment">/*initiliaze mutexs*/</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                <span class="keywordflow">if</span> ( pthread_mutex_init( &amp;netw -&gt; sendbolt, NULL ) != 0 )</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error initializing netw -&gt; sendbolt&quot;</span> );</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( netw );</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                <span class="comment">/*initiliaze mutexs*/</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                <span class="keywordflow">if</span> ( pthread_mutex_init( &amp;netw -&gt; recvbolt, NULL ) != 0 )</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error initializing netw -&gt; recvbolt&quot;</span> );</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                pthread_mutex_destroy( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( netw );</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                <span class="comment">/*initiliaze mutexs*/</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keywordflow">if</span> ( pthread_mutex_init( &amp;netw -&gt; eventbolt, NULL ) != 0 )</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error initializing netw -&gt; eventbolt&quot;</span> );</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                pthread_mutex_destroy( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                pthread_mutex_destroy( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( netw );</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <span class="comment">/* initialize send sem bolt */</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                <span class="keywordflow">if</span>( sem_init(&amp;netw -&gt; send_blocker, 0, 0 ) != 0 )</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error initializing netw -&gt; eventbolt&quot;</span> );</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                                pthread_mutex_destroy( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                pthread_mutex_destroy( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                pthread_mutex_destroy( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( netw );</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="comment">/*initialize queues */</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                netw -&gt; recv_buf = <a class="code" href="group___l_i_s_t.html#gaa82751b4d6a219771661843e61cefa2e">new_generic_list</a>( recv_list_limit );</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                <span class="keywordflow">if</span>( ! netw -&gt; recv_buf )</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error when creating receive list with %d item limit&quot;</span>, recv_list_limit );</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                netw -&gt; send_buf = <a class="code" href="group___l_i_s_t.html#gaa82751b4d6a219771661843e61cefa2e">new_generic_list</a>( send_list_limit );</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">if</span>( !netw -&gt; send_buf )</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                {</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error when creating send list with %d item limit&quot;</span>, send_list_limit );</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                netw -&gt; pools = <a class="code" href="group___l_i_s_t.html#gaa82751b4d6a219771661843e61cefa2e">new_generic_list</a>( -1 );</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <span class="keywordflow">if</span>( !netw -&gt; pools )</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error when creating pools list&quot;</span> );</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                }</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                netw -&gt; addr_infos_loaded = 0 ;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                netw -&gt; send_queue_consecutive_wait = 0 ;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                netw -&gt; so_reuseaddr = -1 ;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                netw -&gt; tcpnodelay = -1 ;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                netw -&gt; so_sndbuf = -1 ;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                netw -&gt; so_rcvbuf = -1 ;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                netw -&gt; so_rcvtimeo = -1 ;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                netw -&gt; so_sndtimeo = -1 ;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                netw -&gt; so_linger = -1 ;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                netw -&gt; deplete_timeout = -1 ;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                netw -&gt; crypto_mode = NETW_CRYPTO_NONE ;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                netw -&gt; crypto_algo = NETW_ENCRYPT_NONE ;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                netw -&gt; <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3dc736265484a58e6678c250e38cef8">send_data</a> = &amp;<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3dc736265484a58e6678c250e38cef8">send_data</a>;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                netw -&gt; <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga1fc319fa3b0eba19e163070a9fb3dae4">recv_data</a> = &amp;<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga1fc319fa3b0eba19e163070a9fb3dae4">recv_data</a>;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                <span class="comment">/* blocking by default */</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                netw -&gt; link . is_blocking = 1 ;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                <span class="keywordflow">return</span> netw ;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;} <span class="comment">/* netw_new() */</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">/*!\fn void *get_in_addr(struct addrinfo *sa)</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment"> *\brief get sockaddr, IPv4 or IPv6</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment"> *\param sa addrinfo to get</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="keywordtype">char</span> *get_in_addr(<span class="keyword">struct</span> sockaddr *sa)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;{</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                <span class="keywordflow">return</span> sa-&gt;sa_family == AF_INET</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                ? (<span class="keywordtype">char</span> *)&amp;(((<span class="keyword">struct</span> sockaddr_in *)sa)-&gt;sin_addr)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                                : (<span class="keywordtype">char</span> *)&amp;(((<span class="keyword">struct </span>sockaddr_in6 *)sa)-&gt;sin6_addr);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;}</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">/*!\fn int netw_init_wsa( int mode , int v1 , int v2 )</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment"> *\brief Do not directly use, internal api. Initialize winsock dll loading on windows if needed.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment"> *\param mode 1 for opening 0 for close 2 for status</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment"> *\param v1 First digit of version requested</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment"> *\param v2 Second digit of version requested</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"> *\return TRUE on success FALSE on error</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00752"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga22bc4dd5d80c2229c3c43f6d6705dece">  752</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga22bc4dd5d80c2229c3c43f6d6705dece">netw_init_wsa</a>( <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> v1, <span class="keywordtype">int</span> v2 )</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;{</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                <span class="keywordtype">int</span> compiler_warning_suppressor = 0 ;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="preprocessor">#if !defined( __linux__ ) &amp;&amp; !defined( __sun ) &amp;&amp; !defined( _AIX )</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="preprocessor"></span>                <span class="keyword">static</span> WSADATA WSAdata; <span class="comment">/*WSA world*/</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                <span class="keyword">static</span> <span class="keywordtype">int</span> WSA_IS_INITIALIZED = 0; <span class="comment">/*status checking*/</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                <span class="keywordflow">switch</span> ( mode )</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                                                <span class="comment">/*returning WSA status*/</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                                <span class="keywordflow">case</span> 2 :</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                                                <span class="keywordflow">return</span> WSA_IS_INITIALIZED;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                                                <span class="comment">/*loading WSA dll*/</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                <span class="keywordflow">case</span> 1 :</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                                                <span class="keywordflow">if</span> ( WSA_IS_INITIALIZED == 1 )</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                                                <span class="keywordflow">return</span> TRUE; <span class="comment">/*already loaded*/</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                                <span class="keywordflow">if</span> ( ( WSAStartup( MAKEWORD( v1, v2 ), &amp;WSAdata ) ) != 0 )</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                                {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                                                                WSA_IS_INITIALIZED = 0;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                                                }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                                {</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                                                WSA_IS_INITIALIZED = 1 ;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                                                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                                }</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                                                <span class="comment">/*unloading (closing) WSA */</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                <span class="keywordflow">case</span> 0 :</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                                                <span class="keywordflow">if</span> ( WSA_IS_INITIALIZED == 0 )</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                                                <span class="keywordflow">return</span> TRUE; <span class="comment">/*already CLEANED or not loaded */</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                                <span class="keywordflow">if</span> ( WSACleanup() == 0 )</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                                {</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                                                WSA_IS_INITIALIZED = 0;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                                                                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                                                }</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                } <span class="comment">/*switch(...)*/</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/*#ifndef __linux__ __sun _AIX */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="preprocessor"></span>                compiler_warning_suppressor = mode + v1 + v2 ;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                compiler_warning_suppressor = TRUE ;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                <span class="keywordflow">return</span> compiler_warning_suppressor ;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;} <span class="comment">/*netw_init_wsa(...)*/</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">/*!\fn int netw_set_blocking( NETWORK *netw , unsigned long int is_blocking )</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> *\brief Modify blocking socket mode</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment"> *\param netw The network to configure</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"> *\param is_blocking 0 NON BLOCk , 1 BLOCK</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gad02f949dd057ae7dd382f03f9364cac0">  806</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gad02f949dd057ae7dd382f03f9364cac0">netw_set_blocking</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> is_blocking )</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;{</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="preprocessor">#if defined(__linux__) || defined(__sun)</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="preprocessor"></span>                <span class="keywordtype">int</span> flags = fcntl( netw -&gt; link . sock, F_GETFL, 0 );</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                <span class="keywordflow">if</span> ( (flags &amp;O_NONBLOCK) &amp;&amp; !is_blocking )</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                {</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;socket %d was already in non-blocking mode&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                                <span class="comment">/* in case we missed it, let&#39;s update the link mode */</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                netw -&gt; link. is_blocking = 0 ;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                <span class="keywordflow">if</span> (!(flags &amp;O_NONBLOCK) &amp;&amp;  is_blocking )</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                <span class="comment">/* in case we missed it, let&#39;s update the link mode */</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                netw -&gt; link. is_blocking = 1 ;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;socket %d was already in blocking mode&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                <span class="keywordflow">if</span>( fcntl(netw -&gt; link . sock, F_SETFL, is_blocking ? flags ^ O_NONBLOCK : flags | O_NONBLOCK) == -1 )</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;couldn&#39;t set blocking mode %d on %d: %s&quot;</span>, is_blocking, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                }</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="preprocessor">#if !defined(__linux__) &amp;&amp; !defined(__sun)</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="preprocessor"></span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> blocking = 1 - is_blocking ;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                <span class="keywordtype">int</span> res = ioctlsocket( netw -&gt; link . sock, FIONBIO, &amp;blocking );</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                error = neterrno ;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                <span class="keywordflow">if</span>( res != NO_ERROR )</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;ioctlsocket failed with error: %ld , neterrno: %s&quot;</span>, res, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                }</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="preprocessor"></span>                netw -&gt; link. is_blocking = is_blocking ;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;} <span class="comment">/* netw_set_blocking */</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">/*!\fn int netw_setsockopt( NETWORK *netw  , int optname , int value )</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment"> *\brief Modify common socket options on the given netw</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment"> *\param netw The socket to configure</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment"> *\param optname NETWORK_DEPLETE_TIMEOUT,NETWORK_CONSECUTIVE_SEND_TIMEOUT ,SO_REUSEADDR,TCP_NODELAY,SO_SNDBUF,SO_RCVBUF,SO_LINGER,SO_RCVTIMEO,SO_SNDTIMEO. Please refer to man setsockopt for details</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment"> *\value The value of the socket parameter</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa5ed966d8c5844ded549eda41e38c0be">  866</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa5ed966d8c5844ded549eda41e38c0be">netw_setsockopt</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> optname, <span class="keywordtype">int</span> value )</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;{</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                <span class="keywordflow">switch</span>( optname )</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                                <span class="keywordflow">case</span> TCP_NODELAY :</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                                <span class="keywordflow">if</span>( value &gt;= 0 )</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                                {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                                                <span class="comment">/* disable naggle algorithm */</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                                                <span class="keywordflow">if</span> ( setsockopt( netw -&gt; link . sock, IPPROTO_TCP, TCP_NODELAY, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * ) &amp;value, <span class="keyword">sizeof</span>( value ) ) == -1 )</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                                                {</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                                                                error = neterrno ;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(TCP_NODELAY) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                                                }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                                                }</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                                netw -&gt; tcpnodelay = value ;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                                break ;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                <span class="keywordflow">case</span> SO_SNDBUF :</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                                <span class="comment">/* socket sending buffer size */</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                                <span class="keywordflow">if</span>( value &gt;= 0 )</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                                {</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                                                <span class="keywordflow">if</span> ( setsockopt ( netw -&gt; link . sock, SOL_SOCKET, SO_SNDBUF, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * ) &amp;value, <span class="keyword">sizeof</span>( value ) ) == -1 )</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                                                {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                                                                error = neterrno ;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_SNDBUF) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                                                }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                                }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                                netw -&gt; so_sndbuf = value ;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                                                break ;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                                <span class="keywordflow">case</span> SO_RCVBUF :</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                                <span class="comment">/* socket receiving buffer */</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                                <span class="keywordflow">if</span>( value &gt;= 0 )</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                                {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                                                                <span class="keywordflow">if</span> ( setsockopt ( netw -&gt; link . sock, SOL_SOCKET, SO_RCVBUF, ( <span class="keyword">const</span> <span class="keywordtype">char</span> * ) &amp;value, <span class="keyword">sizeof</span>( value ) ) == -1 )</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                                                {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                                                                error = neterrno ;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_RCVBUF) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                                                }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                                }</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                                netw -&gt; so_rcvbuf = value ;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                                break ;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                <span class="keywordflow">case</span> SO_REUSEADDR :</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                                <span class="comment">/* lose the pesky &quot;Address already in use&quot; error message*/</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                                <span class="comment">/* Disabled SO_REUSEPORT because not widely supported */</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                                <span class="keywordflow">if</span> ( setsockopt( netw -&gt; link . sock, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *)&amp;value, <span class="keyword">sizeof</span>( value  ) ) == -1 )</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                                {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                                                error=neterrno ;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_REUSEADDR) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                                }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                                netw -&gt; so_reuseaddr = value ;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                                break ;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                                <span class="keywordflow">case</span> SO_LINGER :</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                                                {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                                                                <span class="keyword">struct </span>linger ling;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                                                                <span class="keywordflow">if</span>( value &lt; 0 )</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                                                {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                                                                                ling.l_onoff=0;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                                                                ling.l_linger=0;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                                                                }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( value == 0 )</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                                                                {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                                                                                ling.l_onoff=1;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                                                                                ling.l_linger=0;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                                                }</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                                                                {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                                                                                ling.l_onoff=1;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                                                                                ling.l_linger=value;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                                                                }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="preprocessor">#ifndef __windows__</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="preprocessor"></span>                                                                <span class="keywordflow">if</span>( setsockopt(netw -&gt; link . sock, SOL_SOCKET, SO_LINGER, &amp;ling, <span class="keyword">sizeof</span>( ling ) ) == -1 )</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                                                {</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                                                                                error=neterrno ;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_LINGER) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock,<a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                                                }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="preprocessor"></span>                                                                <span class="keywordflow">if</span>( setsockopt(netw -&gt; link . sock, SOL_SOCKET, SO_LINGER, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)&amp;ling, <span class="keyword">sizeof</span>( ling ) ) == -1 )</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                                                                {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                                                                error=neterrno ;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_LINGER) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock,<a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                                                }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="preprocessor">#endif // __windows__</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor"></span>                                                                netw -&gt; so_linger = value ;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                                                }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                                break ;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                                <span class="keywordflow">case</span> SO_RCVTIMEO :</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                                                <span class="keywordflow">if</span>( value &gt;= 0 )</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                                                {</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor">#ifndef __windows__</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="preprocessor"></span>                                                                {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                                                                                <span class="keyword">struct </span>timeval tv;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                                                                                tv.tv_sec = value ;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                                                                                tv.tv_usec = 0;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                                                                                <span class="keywordflow">if</span>( setsockopt(netw -&gt; link . sock, SOL_SOCKET, SO_RCVTIMEO, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;tv, <span class="keyword">sizeof</span> tv) == -1 )</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                                                                                {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                                                                                                error=neterrno ;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_RCVTIMEO) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                                                                                }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                                                }</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="preprocessor"></span>                                                                <span class="keywordflow">if</span>( setsockopt(netw -&gt; link . sock, SOL_SOCKET, SO_RCVTIMEO, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;value, <span class="keyword">sizeof</span> value ) == -1 )</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                                                {</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                                                                                error=neterrno ;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_RCVTIMEO) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                                                }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="preprocessor"></span>                                                }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                                                netw -&gt; so_rcvtimeo = value ;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                                                break ;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                                <span class="keywordflow">case</span> SO_SNDTIMEO :</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                                                <span class="keywordflow">if</span>( value &gt;= 0 )</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                                                {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="preprocessor">#ifndef __windows__</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="preprocessor"></span>                                                                {</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                                                                                <span class="keyword">struct </span>timeval tv;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                                                                                tv.tv_sec = value ;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                                                                                tv.tv_usec = 0;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                                                                                <span class="keywordflow">if</span>( setsockopt(netw -&gt; link . sock, SOL_SOCKET, SO_SNDTIMEO, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;tv, <span class="keyword">sizeof</span> tv) == -1 )</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                                                                                {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                                                                                                error=neterrno ;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_SNDTIMEO) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                                                                }</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                                                                }</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="preprocessor"></span>                                                                <span class="keywordflow">if</span>( setsockopt(netw -&gt; link . sock, SOL_SOCKET, SO_SNDTIMEO, (<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;value, <span class="keyword">sizeof</span> value ) == -1 )</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                                                {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                                                                                error=neterrno ;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from setsockopt(SO_SNDTIMEO) on socket %d. neterrno: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                                                                }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="preprocessor"></span>                                                }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                                                netw -&gt; so_sndtimeo = value ;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                                                break ;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                                <span class="keywordflow">case</span> NETWORK_DEPLETE_TIMEOUT:</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                                netw -&gt; deplete_timeout = value ;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                                <span class="keywordflow">case</span> NETWORK_CONSECUTIVE_SEND_TIMEOUT:</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                                                netw -&gt; send_queue_consecutive_wait = value ;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                                                break ;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;%d is not a supported setsockopt&quot;</span>, optname );</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                }</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;} <span class="comment">/* netw_set_sock_opt */</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="preprocessor"></span><span class="comment">/***************************************************************************</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"> *                                  _   _ ____  _</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"> *  Project                     ___| | | |  _ \| |</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"> *                             / __| | | | |_) | |</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"> *                            | (__| |_| |  _ &lt;| |___</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"> *                             \___|\___/|_| \_\_____|</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment"> * Copyright (C) 1998 - 2019, Daniel Stenberg, &lt;daniel@haxx.se&gt;, et al.</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment"> * This software is licensed as described in the file COPYING, which</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"> * you should have received as part of this distribution. The terms</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment"> * are also available at https://curl.haxx.se/docs/copyright.html.</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"> * You may opt to use, copy, modify, merge, publish, distribute and/or sell</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> * copies of the Software, and permit persons to whom the Software is</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"> * furnished to do so, under the terms of the COPYING file.</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"> * This software is distributed on an &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment"> * KIND, either express or implied.</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment"> ***************************************************************************/</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">/* &lt;DESC&gt;</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment"> * Show the required mutex callback setups for GnuTLS and OpenSSL when using</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment"> * libcurl multi-threaded.</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment"> * &lt;/DESC&gt;</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">/* A multi-threaded example that uses pthreads and fetches 4 remote files at</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"> * once over HTTPS. The lock callbacks and stuff assume OpenSSL &lt;1.1 or GnuTLS</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment"> * (libgcrypt) so far.</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"> * OpenSSL docs for this:</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"> *   https://www.openssl.org/docs/man1.0.2/man3/CRYPTO_num_locks.html</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment"> * gcrypt docs for this:</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment"> *   https://gnupg.org/documentation/manuals/gcrypt/Multi_002dThreading.html</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">/* we have this global to let the callback get easy access to it */</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="keyword">static</span> pthread_mutex_t *lockarray;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> lock_callback(<span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> type, <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line)</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;{</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                (void)file;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                (void)line;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <span class="keywordflow">if</span>(mode &amp; CRYPTO_LOCK)</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                                pthread_mutex_lock(&amp;(lockarray[type]));</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                                pthread_mutex_unlock(&amp;(lockarray[type]));</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> thread_id(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;{</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ret;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                ret = (<span class="keywordtype">unsigned</span> long)pthread_self();</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;}</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> init_locks(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;{</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                lockarray = (pthread_mutex_t *)OPENSSL_malloc(CRYPTO_num_locks() *</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                                                <span class="keyword">sizeof</span>(pthread_mutex_t));</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                <span class="keywordflow">for</span>(i = 0; i&lt;CRYPTO_num_locks(); i++)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                                pthread_mutex_init(&amp;(lockarray[i]), NULL);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                }</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                CRYPTO_set_id_callback((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> (*)())thread_id);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                CRYPTO_set_locking_callback((<span class="keywordtype">void</span> (*)())lock_callback);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;}</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> kill_locks(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;{</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                CRYPTO_set_locking_callback(NULL);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                <span class="keywordflow">for</span>(i = 0; i&lt;CRYPTO_num_locks(); i++)</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                                pthread_mutex_destroy(&amp;(lockarray[i]));</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                OPENSSL_free(lockarray);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;}</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">/*!\fn int netw_init_openssl( void )</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment"> *\brief Do not directly use, internal api. Initialize openssl</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment"> *\return TRUE</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="keywordtype">int</span> netw_init_openssl( <span class="keywordtype">void</span> )</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;{</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                <span class="keyword">static</span> <span class="keywordtype">int</span> OPENSSL_IS_INITIALIZED = 0; <span class="comment">/*status checking*/</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                <span class="keywordflow">if</span> ( OPENSSL_IS_INITIALIZED == 1 )</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                <span class="keywordflow">return</span> TRUE; <span class="comment">/*already loaded*/</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="preprocessor"></span>                SSL_library_init();</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                SSL_load_error_strings();</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                ERR_load_BIO_strings();</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                OpenSSL_add_all_algorithms();</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                OpenSSL_add_all_algorithms();</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                init_locks();</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                OPENSSL_IS_INITIALIZED = 1 ;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;} <span class="comment">/*netw_init_openssl(...)*/</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">/*!\fn int netw_unload_openssl( void )</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment"> *\brief Do not directly use, internal api. Initialize openssl</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment"> *\return TRUE</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="keywordtype">int</span> netw_init_openssl( <span class="keywordtype">void</span> )</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;{</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                <span class="keyword">static</span> <span class="keywordtype">int</span> OPENSSL_IS_INITIALIZED = 0; <span class="comment">/*status checking*/</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                <span class="keywordflow">if</span> ( OPENSSL_IS_INITIALIZED == 1 )</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                <span class="keywordflow">return</span> TRUE; <span class="comment">/*already loaded*/</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="preprocessor"></span>                SSL_load_error_strings();</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                SSL_library_init();</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                ERR_load_BIO_strings();</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                OpenSSL_add_all_algorithms();</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                OpenSSL_add_all_algorithms();</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                init_locks();</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                OPENSSL_IS_INITIALIZED = 1 ;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;} <span class="comment">/*netw_init_openssl(...)*/</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="keywordtype">int</span> netw_set_crypto( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">char</span> *key, <span class="keywordtype">char</span> *certificat, <span class="keywordtype">char</span> *vigenere )</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;{</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                <span class="keywordflow">if</span>( key &amp;&amp; strlen( key ) &gt; 0 )</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                {</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                                netw -&gt; key = strdup( key );</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                }</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                <span class="keywordflow">if</span>( certificat &amp;&amp; strlen( certificat ) &gt; 0 )</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                                netw -&gt; certificat = strdup( certificat );</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                <span class="keywordflow">if</span>( vigenere &amp;&amp; strlen( vigenere ) &gt; 0 )</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                                netw -&gt; vigenere = strdup( vigenere );</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                }</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                netw_init_openssl();</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                netw -&gt; method = TLSv1_2_method();         <span class="comment">/* create new server-method instance */</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                netw -&gt; ctx    = SSL_CTX_new(method);      <span class="comment">/* create new context from method */</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                <span class="keywordflow">if</span> ( ctx == NULL )</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                {</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> error = 0 ;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                <span class="keywordflow">while</span>( error = ERR_get_error() )</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                                {</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;%s on socket %d&quot;</span>, ERR_reason_error_string( ERR_get_error(), NULL ) );</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                                }</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                                EVP_CIPHER_CTX_free( netw -&gt; ctx  );</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;} <span class="comment">/* netw_set_crypto */</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="preprocessor">#endif // HAVE_OPENSSL WIP</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">/*!\fn int netw_connect_ex(NETWORK **netw , char *host , char *port, int send_list_limit , int recv_list_limit , int ip_version )</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment"> *\brief Use this to connect a NETWORK to any listening one</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment"> *\param netw a NETWORK *object</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment"> *\param host Host or IP to connect to</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment"> *\param port Port to use to connect</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment"> *\param send_list_limit Internal sending list maximum number of item. 0 or negative for unrestricted</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment"> *\param recv_list_limit Internal receiving list maximum number of item. 0 or negative for unrestricted</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"> *\param ip_version NETWORK_IPALL for both ipv4 and ipv6 , NETWORK_IPV4 or NETWORK_IPV6</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga4cef67bc400323306a3d1c1ed5cec17b"> 1243</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga4cef67bc400323306a3d1c1ed5cec17b">netw_connect_ex</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> **netw, <span class="keywordtype">char</span> *host, <span class="keywordtype">char</span> *port, <span class="keywordtype">int</span> send_list_limit, <span class="keywordtype">int</span> recv_list_limit, <span class="keywordtype">int</span> ip_version )</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;{</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                <span class="keywordtype">int</span> error = 0, net_status = 0;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                <span class="comment">/*do not work over an already used netw*/</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                <span class="keywordflow">if</span>( (*netw) )</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Unable to allocate (*netw), already existing. You must use empty NETWORK *structs.&quot;</span> );</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                }</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                <span class="comment">/*creating array*/</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                (*netw) = <a class="code" href="n__network_8c.html#a9caee75e3a67942e37ccb4de2c889105">netw_new</a>( send_list_limit, recv_list_limit );</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw&amp;&amp;(*netw), <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                <span class="comment">/*checking WSA when under windows*/</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga22bc4dd5d80c2229c3c43f6d6705dece">netw_init_wsa</a>( 1, 2, 2 ) == FALSE )</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                {</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Unable to load WSA dll&#39;s&quot;</span> );</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( (*netw) );</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                }</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                <span class="comment">/* choose ip version */</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                <span class="keywordflow">if</span>( ip_version == NETWORK_IPV4 )</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                (*netw) -&gt; link . hints . ai_family   = AF_INET ;     <span class="comment">/* Allow IPv4 */</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                }</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ip_version == NETWORK_IPV6 )</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                {</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                                (*netw) -&gt; link . hints . ai_family   = AF_INET6 ;     <span class="comment">/* Allow IPv6 */</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                }</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                {</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                                <span class="comment">/* NETWORK_ALL or unknown value */</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                                (*netw) -&gt; link . hints . ai_family   = AF_UNSPEC;     <span class="comment">/* Allow IPv4 or IPv6 */</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                }</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                (*netw) -&gt; link . hints . ai_socktype = SOCK_STREAM;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                (*netw) -&gt; link . hints . ai_protocol = IPPROTO_TCP;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                (*netw) -&gt; link . hints . ai_flags    = AI_PASSIVE;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                (*netw) -&gt; link . hints . ai_canonname = NULL;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                (*netw) -&gt; link . hints . ai_next = NULL;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                <span class="comment">/* Note: on some system, i.e Solaris, it WILL show leak in getaddrinfo.</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">                 * Testing it inside a 1,100 loop showed not effect on the amount of leaked</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">                 * memory */</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                error = getaddrinfo( host, port, &amp;(*netw) -&gt; link . hints, &amp;(*netw) -&gt; link . rhost );</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                <span class="keywordflow">if</span>( error != 0 )</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                {</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error when resolving %s:%s getaddrinfo: %s&quot;</span>, host, port, gai_strerror( error ) );</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw) );</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                (*netw) -&gt; addr_infos_loaded = 1 ;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( (*netw) -&gt; link . ip, <span class="keywordtype">char</span>, 64 );</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( (*netw) -&gt; link . ip, <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw ) ); <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;                <span class="comment">/* getaddrinfo() returns a list of address structures. Try each address until we successfully connect. If socket or connect fails, we close the socket and try the next address. */</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;                <span class="keyword">struct </span>addrinfo *rp = NULL ;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;                <span class="keywordflow">for</span>( rp = (*netw) -&gt; link . rhost ; rp != NULL ; rp = rp -&gt; ai_next )</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;                {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                                <span class="keywordtype">int</span> sock = socket( rp -&gt; ai_family, rp -&gt; ai_socktype, rp-&gt;ai_protocol );</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                                <span class="keywordflow">if</span>( sock == -1 )</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                                {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                                                error = neterrno ;</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error while trying to make a socket: %s&quot;</span>, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                                                continue ;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                                }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                                (*netw) -&gt; link . sock = sock ;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                                net_status = connect( sock, rp -&gt; ai_addr, rp -&gt; ai_addrlen );</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                                <span class="keywordflow">if</span>( net_status == -1 )</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                                {</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                                                error = neterrno ;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#gaeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a>, <span class="stringliteral">&quot;connecting to %s:%s : %s&quot;</span>, host, port, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                                                closesocket( sock );</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                                                (*netw) -&gt; link . sock = -1 ;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                                                continue ;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                                }</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                                {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                                                <span class="comment">/*storing connected port and ip adress*/</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                                                <span class="keywordflow">if</span>(!inet_ntop( rp-&gt;ai_family, get_in_addr( rp -&gt; ai_addr ), (*netw) -&gt; link . ip, 64 ) )</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                                                {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                                                                error = neterrno ;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;inet_ntop: %p , %s&quot;</span>, rp, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                                }</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                                                <span class="keywordflow">break</span>;                  <span class="comment">/* Success */</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                                }</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                }</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                <span class="keywordflow">if</span>( rp == NULL )</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                                <span class="comment">/* No address succeeded */</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Couldn&#39;t connect to %s:%s : no adress succeeded&quot;</span>, host, port );</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw) );</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                }</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                (*netw)-&gt;link . port = strdup( port );</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( (*netw) -&gt; link . port, <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw ) ); <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="preprocessor"></span>                (*netw) -&gt; key = NULL ;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                (*netw) -&gt; certificat = NULL ;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                (*netw) -&gt; vigenere_key = NULL ;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Connected to %s:%s&quot;</span>, (*netw) -&gt; link . ip, (*netw) -&gt; link . port );</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( (*netw), NETW_CLIENT|NETW_RUN|NETW_THR_ENGINE_STOPPED );</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;} <span class="comment">/* netw_connect_ex(...)*/</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">/*!\fn int netw_connect( NETWORK **netw , char *host , char *port , int ip_version )</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment"> *\brief Use this to connect a NETWORK to any listening one, unrestricted send/recv lists</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment"> *\param netw a NETWORK *object</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment"> *\param host Host or IP to connect to</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment"> *\param port Port to use to connect</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment"> *\param ip_version NETWORK_IPALL for both ipv4 and ipv6 , NETWORK_IPV4 or NETWORK_IPV6</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gae18d52a130063ba1fd0a4cf4b6a2da20"> 1378</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gae18d52a130063ba1fd0a4cf4b6a2da20">netw_connect</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> **netw, <span class="keywordtype">char</span> *host, <span class="keywordtype">char</span> *port, <span class="keywordtype">int</span> ip_version )</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;{</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#gaeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a>, <span class="stringliteral">&quot;Trying to connect to %s : %s&quot;</span>, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( host ), <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( port ) );</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga4cef67bc400323306a3d1c1ed5cec17b">netw_connect_ex</a>( &amp;(*netw), host, port, -1, -1, ip_version );</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;} <span class="comment">/* netw_connect() */</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">/*!\fn int netw_get_state( NETWORK *netw , int *state , int *thr_engine_status )</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment"> *\brief Get the state of a network</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"> *\param netw The NETWORK *connection to query</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment"> *\param state pointer to network status storage , NETW_RUN , NETW_EXIT_ASKED , NETW_EXITED</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment"> *\param thr_engine_status pointer to network thread engine status storage ,NETW_THR_ENGINE_STARTED , NETW_THR_ENGINE_STOPPED</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db"> 1393</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> *state, <span class="keywordtype">int</span> *thr_engine_status )</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;{</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                <span class="keywordflow">if</span>( netw )</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                {</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                                <span class="keywordflow">if</span>( state )</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                                                (*state) = netw -&gt; state ;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                                <span class="keywordflow">if</span>( thr_engine_status )</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                                                (*thr_engine_status) = netw -&gt; threaded_engine_status ;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                }</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Can&#39;t get status of a NULL network&quot;</span> );</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                }</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;} <span class="comment">/*netw_get_state() */</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">/*!\fn int netw_set( NETWORK *netw , int flag )</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment"> *\brief Restart or reset the specified network ability</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment"> *\param netw The NETWORK *connection to modify</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment"> *\param flag NETW_EMPTY_SENDBUF, NETW_EMPTY_RECVBUF, NETW_RUN , NETW_EXIT_ASKED , NETW_EXITED</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33"> 1420</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> flag )</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;{</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_EMPTY_SENDBUF )</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                {</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                                <span class="keywordflow">if</span>( netw -&gt; send_buf )</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                                <a class="code" href="group___l_i_s_t.html#ga1dafe7a250ddad51fadd375f057287e7">list_empty</a>( netw -&gt; send_buf );</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                };</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_EMPTY_RECVBUF )</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                                pthread_mutex_lock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                                <span class="keywordflow">if</span>( netw -&gt; recv_buf )</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                                                <a class="code" href="group___l_i_s_t.html#ga1dafe7a250ddad51fadd375f057287e7">list_empty</a>( netw -&gt; recv_buf );</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_DESTROY_SENDBUF )</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                                <span class="keywordflow">if</span>( netw -&gt; send_buf )</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                                                <a class="code" href="group___l_i_s_t.html#ga90d32fef68ce6f3ec0a7b4085690c755">list_destroy</a>( &amp;netw -&gt; send_buf );</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                };</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_DESTROY_RECVBUF )</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                                pthread_mutex_lock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                                <span class="keywordflow">if</span>( netw -&gt; recv_buf )</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                                                <a class="code" href="group___l_i_s_t.html#ga90d32fef68ce6f3ec0a7b4085690c755">list_destroy</a>( &amp;netw -&gt; recv_buf );</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                }</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_CLIENT )</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                {</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                                netw -&gt; mode = NETW_CLIENT ;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                }</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_SERVER )</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                                netw -&gt; mode = NETW_SERVER ;</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                }</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_RUN )</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                {</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                                netw -&gt; state = NETW_RUN ;</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                }</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_EXITED )</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                {</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                                netw -&gt; state = NETW_EXITED ;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;                }</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_ERROR )</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                                netw -&gt; state = NETW_ERROR ;</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                }</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_EXIT_ASKED )</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                {</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                                netw -&gt; state = NETW_EXIT_ASKED ;</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                }</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_THR_ENGINE_STARTED )</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                {</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                                netw -&gt; threaded_engine_status = NETW_THR_ENGINE_STARTED ;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                <span class="keywordflow">if</span>( flag &amp; NETW_THR_ENGINE_STOPPED )</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                                netw -&gt; threaded_engine_status = NETW_THR_ENGINE_STOPPED ;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                }</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                sem_post( &amp;netw -&gt; send_blocker );</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;} <span class="comment">/* netw_set(...) */</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">/*!\fn netw_close( NETWORK **netw )</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment"> *\brief Closing a specified Network, destroy queues, free the structure</span></div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment"> *\param netw A NETWORK *network to close</span></div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment"> *\return TRUE on success , FALSE on failure</span></div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a"> 1497</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> **netw )</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;{</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                <span class="keywordtype">int</span> state = 0, thr_engine_status = 0 ;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw&amp;&amp;(*netw), <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                <a class="code" href="group___l_i_s_t.html#ga55cdaac0dd0f4f4d687607e6679a4634">list_foreach</a>( node, (*netw) -&gt; pools )</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                                <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *pool = (<a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *)node -&gt; ptr ;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                                netw_pool_remove( pool, (*netw) );</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                }</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                <a class="code" href="group___l_i_s_t.html#ga90d32fef68ce6f3ec0a7b4085690c755">list_destroy</a>( &amp;(*netw) -&gt; pools );</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( (*netw), &amp;state, &amp;thr_engine_status );</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                <span class="keywordflow">if</span>( thr_engine_status == NETW_THR_ENGINE_STARTED )</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                {</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga29159184519b3129c0154b1a2c2a3e2f">netw_stop_thr_engine</a>( (*netw ) );</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                }</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                <span class="comment">/*closing connection*/</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                <span class="comment">/* Now with end of send fix */</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                <span class="keywordflow">if</span>( (*netw) -&gt; link . sock != INVALID_SOCKET )</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                {</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                                closesocket( (*netw) -&gt; link . sock );</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;socket %d closed&quot;</span>, (*netw) -&gt; link . sock );</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( (*netw) -&gt; link . ip );</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( (*netw) -&gt; link . port );</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="preprocessor"></span>                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( (*netw) -&gt; key );</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( (*netw) -&gt; certificat );</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="preprocessor"></span>                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( (*netw) -&gt; vigenere_key );</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                <span class="keywordflow">if</span>( (*netw) -&gt; link . rhost )</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                {</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                                freeaddrinfo( (*netw) -&gt; link . rhost );</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                }</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                <span class="comment">/*list freeing*/</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( (*netw), NETW_DESTROY_SENDBUF|NETW_DESTROY_RECVBUF );</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                pthread_mutex_destroy( &amp;(*netw) -&gt; recvbolt );</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                pthread_mutex_destroy( &amp;(*netw) -&gt; sendbolt );</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                pthread_mutex_destroy( &amp;(*netw) -&gt; eventbolt );</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                sem_destroy( &amp;(*netw) -&gt; send_blocker );</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( (*netw) );</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;} <span class="comment">/* netw_close(...)*/</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment">/*!\fn int deplete_send_buffer( int fd , long timeout )</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"> *\brief wait until the socket is empty or timeout, checking each 100 msec. Not as reliable as expected.</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment"> *\param fd socket descriptor</span></div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment"> *\timeout timeout value in msec , zero or negative value =&gt; disabled</span></div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment"> *\return 0 or the amount of remaining datas in bytes</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"><a class="line" href="n__network_8c.html#a47e28ca4745f27fc86baf2ce2848d295"> 1558</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="n__network_8c.html#a47e28ca4745f27fc86baf2ce2848d295">deplete_send_buffer</a>( <span class="keywordtype">int</span> fd, <span class="keywordtype">long</span> timeout )</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;{</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="preprocessor">#if defined( __linux__ )</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="preprocessor"></span>                <span class="keywordtype">int</span> outstanding = 0 ;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                <span class="keywordflow">if</span>( timeout &lt;= 0 )</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                                <span class="keywordflow">return</span> 0 ;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                <span class="keywordflow">for</span>( <span class="keywordtype">int</span> it = 0 ; it &lt; timeout ; it += 100 )</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                {</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                                outstanding = 0 ;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                                ioctl(fd, SIOCOUTQ, &amp;outstanding);</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                                <span class="keywordflow">if</span>(!outstanding)</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                                {</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                                }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                                usleep( 100000 );</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                }</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                <span class="keywordflow">return</span> outstanding ;</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="preprocessor"></span>                (void)fd;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                (void)timeout;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                <span class="keywordflow">return</span> 0 ;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="preprocessor"></span>}</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">/*!\fn netw_wait_close( NETWORK **netw )</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment"> *\brief Wait for peer closing a specified Network, destroy queues, free the structure. Default 30 seconds timeout</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment"> *\warning Do not use on the accept socket itself (the server socket) as it will display false errors</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment"> *\param netw A NETWORK *network to close</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment"> *\return TRUE on success , FALSE on failure</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga60beb772aa298f36d1443a28e3ec5ec8"> 1591</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga60beb772aa298f36d1443a28e3ec5ec8">netw_wait_close</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> **netw )</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;{</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                <span class="comment">// default 30 secs timeout</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga995d9aaabaca026d79f15a9823eaebaf">netw_wait_close_timed</a>( netw, 30 );</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;} <span class="comment">/* netw_wait_close(...)*/</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">/*!\fn netw_wait_close_timed( NETWORK **netw , int timeout )</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment"> *\brief Wait for peer closing a specified Network, destroy queues, free the structure</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment"> *\warning Do not use on the accept socket itself (the server socket) as it will display false errors</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment"> *\param netw A NETWORK *network to close</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment"> *\param timeout timeout in seconds before force close engine</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment"> *\return TRUE on success , FALSE on failure</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga995d9aaabaca026d79f15a9823eaebaf"> 1606</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga995d9aaabaca026d79f15a9823eaebaf">netw_wait_close_timed</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> **netw, <span class="keywordtype">int</span> timeout )</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;{</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                <span class="keywordtype">int</span> state = 0, thr_engine_status = 0 ;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw&amp;&amp;(*netw), <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                <span class="keywordtype">int</span> error = 0,</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                                countdown = 0 ;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                <span class="keywordtype">int</span> nb_running = 0 ;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                countdown = timeout ;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( (*netw), &amp;state, &amp;thr_engine_status );</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                <span class="keywordflow">if</span>( thr_engine_status == NETW_THR_ENGINE_STARTED )</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                {</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                                <span class="keywordflow">do</span></div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                                {</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                                                pthread_mutex_lock( &amp;(*netw) -&gt; eventbolt );</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                                                nb_running = (*netw) -&gt; nb_running_threads ;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                                                pthread_mutex_unlock( &amp;(*netw) -&gt; eventbolt );</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                                                sleep( 1 );</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                                                countdown -- ;</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                                }</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                                <span class="keywordflow">while</span>( nb_running &gt; 0 &amp;&amp; countdown &gt; 0 );</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( (*netw), &amp;state, &amp;thr_engine_status );</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                                <span class="keywordflow">if</span>( countdown == 0 &amp;&amp; nb_running &gt; 0 )</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                                {</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;netw %d: %d threads are still running after %d seconds, netw is in state %s (%d)&quot;</span>, (*netw) -&gt; link . sock, nb_running , timeout , N_ENUM_ENTRY(__netw_code_type,toString)(state) , state );</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                }</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                }</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                <span class="comment">/* wait for close fix */</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                <span class="keywordflow">if</span>( (*netw) -&gt; link . sock != INVALID_SOCKET )</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                                <span class="comment">/* inform peer that we have finished */</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                                shutdown( (*netw) -&gt; link . sock, SHUT_WR );</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                                <span class="keywordtype">int</span> remaining = <a class="code" href="n__network_8c.html#a47e28ca4745f27fc86baf2ce2848d295">deplete_send_buffer</a>( (*netw) -&gt; link . sock, (*netw) -&gt; deplete_timeout );</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                                <span class="keywordflow">if</span>( remaining &gt; 0 )</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                                {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;socket %d (%s:%s) %d octets still in send buffer before closing after a wait of %d seconds&quot;</span>, (*netw) -&gt; link . sock, (*netw) -&gt; link . ip, (*netw) -&gt; link . port, remaining , (<span class="keywordtype">int</span>)(*netw) -&gt; deplete_timeout );</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                                }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                                <span class="comment">/* wait for fin ack */</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                                <span class="keywordtype">char</span> buffer[ 4096 ] = <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                                <span class="keywordflow">for</span>( <span class="keywordtype">int</span> it = 0 ; it &lt; timeout ; it += 100 )</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                                {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                                                <span class="keywordtype">int</span> res = 0 ;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                                                res = recv( (*netw) -&gt; link . sock, buffer, 4096, NETFLAGS );</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                                                <span class="keywordflow">if</span>( !res )</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                                                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                                                <span class="keywordflow">if</span>( res &lt; 0 )</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                                                {</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                                                                error = neterrno ;</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                                                                <span class="keywordflow">if</span>( error != ENOTCONN &amp;&amp; error != 10057 &amp;&amp; error != EINTR &amp;&amp; error != ECONNRESET ) <span class="comment">// no an error if already closed</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                                                                {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;read returned error %d when closing socket %d (%s:%s): %s&quot;</span>, error, (*netw) -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( (*netw) -&gt; link . ip ), (*netw) -&gt; link . port,  <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                                                                }</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                                                                break ;</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                                                }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                                                usleep( 100000 );</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                                }</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw) );</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;} <span class="comment">/* netw_wait_close_timed(...)*/</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">/*!\fn int netw_make_listening( NETWORK **netw , char *addr , char *port , int nbpending  , int ip_version )</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment"> *\brief Make a NETWORK be a Listening network</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment"> *\param netw A NETWORK **network to make listening</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment"> *\param addr Adress to bind, NULL for automatic address filling</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment"> *\param port For choosing a PORT to listen to</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment"> *\param nbpending Number of pending connection when listening</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment"> *\param ip_version NETWORK_IPALL for both ipv4 and ipv6 , NETWORK_IPV4 or NETWORK_IPV6</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment"> *\return TRUE on success, FALSE on error</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga52afd4f5662c9c8f334d224ae2cdbdf2"> 1684</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga52afd4f5662c9c8f334d224ae2cdbdf2">netw_make_listening</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> **netw, <span class="keywordtype">char</span> *addr, <span class="keywordtype">char</span> *port, <span class="keywordtype">int</span> nbpending, <span class="keywordtype">int</span> ip_version )</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;{</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( port, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                <span class="keywordflow">if</span>( *netw )</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                {</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Cannot use an allocated network. Please pass a NULL network to modify&quot;</span> );</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                }</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                <span class="comment">/*checking WSA when under windows*/</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga22bc4dd5d80c2229c3c43f6d6705dece">netw_init_wsa</a>( 1, 2, 2 ) == FALSE )</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Unable to load WSA dll&#39;s&quot;</span> );</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                }</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                (*netw) = <a class="code" href="n__network_8c.html#a9caee75e3a67942e37ccb4de2c889105">netw_new</a>( -1, -1 );</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                (*netw) -&gt; link . port = strdup( port );</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                <span class="comment">/*creating array*/</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                <span class="keywordflow">if</span>( ip_version == NETWORK_IPV4 )</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                {</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                                (*netw) -&gt; link . hints . ai_family   = AF_INET ;     <span class="comment">/* Allow IPv4 */</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                }</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ip_version == NETWORK_IPV6 )</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                {</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                                (*netw) -&gt; link . hints . ai_family   = AF_INET6 ;     <span class="comment">/* Allow IPv6 */</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                }</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                {</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                                <span class="comment">/* NETWORK_ALL or unknown value */</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                                (*netw) -&gt; link . hints . ai_family   = AF_UNSPEC;     <span class="comment">/* Allow IPv4 or IPv6 */</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                }</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                <span class="keywordflow">if</span>( !addr )</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                                (*netw) -&gt; link . hints . ai_flags    = AI_PASSIVE;    <span class="comment">/* For wildcard IP address */</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                }</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                (*netw) -&gt; link . hints . ai_socktype = SOCK_STREAM;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                (*netw) -&gt; link . hints . ai_protocol = IPPROTO_TCP;</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                (*netw) -&gt; link . hints . ai_canonname = NULL;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                (*netw) -&gt; link . hints . ai_next = NULL;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;                error = getaddrinfo( addr, port, &amp;(*netw) -&gt; link . hints, &amp;(*netw) -&gt; link . rhost );</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                <span class="keywordflow">if</span>( error != 0)</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error when resolving %s:%s getaddrinfo: %s&quot;</span>, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( addr ),  port, gai_strerror( error ) );</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw) );</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                }</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                (*netw) -&gt; addr_infos_loaded = 1 ;</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                <span class="comment">/* getaddrinfo() returns a list of address structures.</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">                   Try each address until we successfully connect(2).</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">                   If socket(2) (or connect(2)) fails, we (close the socket</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">                   and) try the next address. */</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                <span class="keyword">struct </span>addrinfo *rp = NULL ;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                <span class="keywordflow">for</span>( rp = (*netw) -&gt; link . rhost ; rp != NULL ; rp = rp -&gt; ai_next )</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                                (*netw) -&gt; link . sock = socket( rp -&gt; ai_family, rp -&gt; ai_socktype, rp-&gt;ai_protocol );</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                                <span class="keywordflow">if</span>( (*netw) -&gt; link . sock == INVALID_SOCKET )</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                                {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                                                error = neterrno ;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error while trying to make a socket: %s&quot;</span>, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                                                continue ;</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                                }</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa5ed966d8c5844ded549eda41e38c0be">netw_setsockopt</a>( (*netw), SO_REUSEADDR, 1 );</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                                <span class="keywordflow">if</span>( bind( (*netw) -&gt; link . sock, rp -&gt; ai_addr, rp -&gt; ai_addrlen ) == 0 )</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                                {</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                                                <span class="keywordtype">char</span> *ip = NULL ;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( ip, <span class="keywordtype">char</span>, 64 );</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                                                <span class="keywordflow">if</span>( !ip )</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                                                {</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error allocating 64 bytes for ip&quot;</span> );</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw) );</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                                                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                                                }</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                                                <span class="keywordflow">if</span>( !inet_ntop( rp -&gt; ai_family, get_in_addr( rp -&gt; ai_addr ), ip, 64 ) )</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;                                                {</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;                                                                error = neterrno ;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;inet_ntop: %p , %s&quot;</span>, (*netw) -&gt; link . raddr, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                                                }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                                                <span class="comment">/*n_log( LOG_DEBUG, &quot;Socket %d successfully binded to %s %s&quot;,  (*netw) -&gt; link . sock, _str( ip ) , _str( port ) );*/</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                                                (*netw) -&gt; link . ip = ip ;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                                                <span class="keywordflow">break</span>;                  <span class="comment">/* Success */</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                                }</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error from bind() on port %s neterrno: %s&quot;</span>, port, netstrerror( neterrno ), error );</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;                                closesocket( (*netw) -&gt; link .sock );</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;                }</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                <span class="keywordflow">if</span>( rp == NULL )</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                {</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                                <span class="comment">/* No address succeeded */</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Couldn&#39;t get a socket for listening on port %s&quot;</span>, port );</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;(*netw) );</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                }</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                <span class="comment">/* nb_pending connections*/</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                ( *netw ) -&gt; nb_pending = nbpending ;</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;                listen( ( *netw ) -&gt; link . sock, ( *netw ) -&gt; nb_pending );</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( (*netw), NETW_SERVER|NETW_RUN|NETW_THR_ENGINE_STOPPED );</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;} <span class="comment">/* netw_make_listening(...)*/</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">/*!\fn NETWORK *netw_accept_from_ex( NETWORK *from , int send_list_limit , int recv_list_limit , int non_blocking , int *retval )</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment"> *\brief make a normal &#39;accept&#39; . Network &#39;from&#39; must be allocated with netw_make_listening.</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment"> *\param from the network from where we accept</span></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment"> *\param send_list_limit Internal sending list maximum number of item. 0 or negative for unrestricted</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment"> *\param recv_list_limit Internal receiving list maximum number of item. 0 or negative for unrestricted</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment"> *\param non_blocking set to -1 to make it non blocking, to 0 for blocking, else it&#39;s the select timeout value in msecs.</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment"> *\param retval EAGAIN ou EWOULDBLOCK or neterrno (use netstrerr( retval) to obtain a string describing the code )</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment"> *\return NULL on failure, if not a pointer to the connected network</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaea0a4d9c8822d25ed88e6554a88cb996"> 1810</a></span>&#160;<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaea0a4d9c8822d25ed88e6554a88cb996">netw_accept_from_ex</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *from, <span class="keywordtype">int</span> send_list_limit, <span class="keywordtype">int</span> recv_list_limit, <span class="keywordtype">int</span> non_blocking, <span class="keywordtype">int</span> *retval )</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;{</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                <span class="keywordtype">int</span> tmp = 0, error = 0;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="preprocessor">#if defined( __linux__ ) || defined( __sun ) || defined( _AIX )</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="preprocessor"></span>                socklen_t sin_size = 0 ;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="preprocessor"></span>                <span class="keywordtype">int</span> sin_size = 0 ;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw = NULL ;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                <span class="comment">/*checking WSA when under windows*/</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga22bc4dd5d80c2229c3c43f6d6705dece">netw_init_wsa</a>( 1, 2, 2 ) == FALSE )</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                {</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Unable to load WSA dll&#39;s&quot;</span> );</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                }</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( from, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                netw = <a class="code" href="n__network_8c.html#a9caee75e3a67942e37ccb4de2c889105">netw_new</a>( send_list_limit, recv_list_limit );</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                sin_size = <span class="keyword">sizeof</span>( netw -&gt; link . raddr );</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                <span class="keywordflow">if</span>( non_blocking &gt; 0 )</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                {</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                                <span class="keywordtype">int</span> secs = non_blocking/1000 ;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                                <span class="keywordtype">int</span> usecs = (non_blocking%1000)*1000;</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                                <span class="keyword">struct </span>timeval select_timeout = { secs , usecs };</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                                fd_set accept_set ;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                                FD_SET( from -&gt; link . sock, &amp;accept_set );</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                                FD_ZERO( &amp;accept_set );</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                                <span class="keywordtype">int</span> ret = select( from -&gt; link . sock + 1, &amp;accept_set, NULL, NULL, &amp;select_timeout );</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                                <span class="keywordflow">if</span>( ret == -1 )</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                                {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                                                error = neterrno ;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                                                <span class="keywordflow">if</span>( retval != NULL )</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                                                                (*retval) = error ;</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error on select with timeout %ds (%d.%ds), neterrno: %s&quot;</span>, non_blocking , secs , usecs , <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                                                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                                }</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ret == 0 )</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                                {</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                                                <span class="comment">/* that one produce waaaay too much logs under a lot of cases */</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                                                <span class="comment">/* n_log( LOG_DEBUG , &quot;No connection waiting on %d&quot; , from -&gt; link . sock ); */</span></div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                                                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                                }</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                                <span class="keywordflow">if</span>( FD_ISSET(  from -&gt; link . sock, &amp;accept_set ) )</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                                {</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                                                <span class="comment">//n_log( LOG_DEBUG, &quot;select accept call on %d&quot;, from -&gt; link . sock );</span></div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                                                tmp = accept( from -&gt; link . sock, (<span class="keyword">struct</span> sockaddr * )&amp;netw -&gt; link . raddr, &amp;sin_size );</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                                                <span class="keywordflow">if</span> ( tmp &lt; 0 )</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                                                {</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                                                                error = neterrno ;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                                                                <span class="keywordflow">if</span>( retval != NULL )</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                                                                                (*retval) = error ;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;error accepting on %d, %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                                                                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                                                }</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                                }</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                                {</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                                                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                                }</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                                netw -&gt; link . is_blocking = 1 ;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                }</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( non_blocking == -1 )</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                {</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                                <span class="keywordflow">if</span>( from -&gt; link . is_blocking  == 1 )</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                                {</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gad02f949dd057ae7dd382f03f9364cac0">netw_set_blocking</a>( from, 0 );</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#gaeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a>, <span class="stringliteral">&quot;changed to non blocking accept call on %d&quot;</span>, from -&gt; link . sock );</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                                }</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                                tmp = accept( from -&gt; link . sock, (<span class="keyword">struct</span> sockaddr *)&amp;netw -&gt; link . raddr, &amp;sin_size );</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                                <span class="keywordflow">if</span>( retval != NULL )</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                                                (*retval) = error ;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                                <span class="keywordflow">if</span> ( tmp &lt; 0 )</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                                {</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                                                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                                }</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                                netw -&gt; link . is_blocking = 0 ;</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                }</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                {</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                                <span class="keywordflow">if</span>( from -&gt; link . is_blocking  == 0 )</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                                {</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gad02f949dd057ae7dd382f03f9364cac0">netw_set_blocking</a>( from, 1 );</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;changed to blocking accept call on %d&quot;</span>, from -&gt; link . sock );</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                                }</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                                tmp = accept( from -&gt; link . sock, (<span class="keyword">struct</span> sockaddr *)&amp;netw -&gt; link . raddr, &amp;sin_size );</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                                <span class="keywordflow">if</span> ( tmp &lt; 0 )</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                                {</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                                                error = neterrno ;</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;error accepting on %d, %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                                                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                                }</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                }</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                netw -&gt; link . sock = tmp ;</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                netw -&gt; link . port = strdup( from -&gt; link . port );</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( netw -&gt; link . ip, <span class="keywordtype">char</span>, 64 );</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                <span class="keywordflow">if</span>( !netw -&gt; link . ip )</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                {</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Error allocating 64 bytes for ip&quot;</span> );</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a>( &amp;netw );</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                }</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                <span class="keywordflow">if</span>( !inet_ntop( netw -&gt; link . raddr . ss_family, get_in_addr( ((<span class="keyword">struct</span> sockaddr *)&amp;netw -&gt; link . raddr) ), netw -&gt; link . ip, 64 ) )</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                {</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;inet_ntop: %p , %s&quot;</span>, netw -&gt; link . raddr, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                }</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa5ed966d8c5844ded549eda41e38c0be">netw_setsockopt</a>( netw, SO_REUSEADDR, 1 );</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_SERVER|NETW_RUN|NETW_THR_ENGINE_STOPPED );</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Connection accepted from %s:%s&quot;</span>, netw-&gt; link . ip, netw -&gt; link . port );</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                <span class="keywordflow">return</span> netw;</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;} <span class="comment">/* netw_accept_from_ex(...) */</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment">/*!\fn NETWORK *netw_accept_from( NETWORK *from )</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="comment"> *\brief make a normal blocking &#39;accept&#39; . Network &#39;from&#39; must be allocated with netw_make_listening.</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;<span class="comment"> *\param from The network from which to obtaion the connection</span></div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;<span class="comment"> *\return NULL</span></div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf21b84460e80c7853bcb8321d7c53065"> 1957</a></span>&#160;<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf21b84460e80c7853bcb8321d7c53065">netw_accept_from</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *from )</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;{</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaea0a4d9c8822d25ed88e6554a88cb996">netw_accept_from_ex</a>( from, 0 , 0 , 0 , NULL );</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;} <span class="comment">/* network_accept_from( ... ) */</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">/*!\fn NETWORK *netw_accept_nonblock_from( NETWORK *from , int blocking )</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment"> *\brief make a normal blocking &#39;accept&#39; . Network &#39;from&#39; must be allocated with netw_make_listening.</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment"> *\param from The network from which to obtaion the connection</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;<span class="comment"> *\param blocking set to -1 to make it non blocking, to 0 for blocking, else it&#39;s the select timeout value in mseconds.</span></div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment"> *\return NULL</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga45b053eef50f122d73a1c9b094b5a1d7"> 1970</a></span>&#160;<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga45b053eef50f122d73a1c9b094b5a1d7">netw_accept_nonblock_from</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *from, <span class="keywordtype">int</span> blocking )</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;{</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaea0a4d9c8822d25ed88e6554a88cb996">netw_accept_from_ex</a>( from, 0 , 0 , blocking , NULL );</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;} <span class="comment">/* network_accept_from( ... ) */</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">/*!\fn int netw_add_msg( NETWORK *netw , N_STR *msg )</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment"> *\brief Add a message to send in aimed NETWORK</span></div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;<span class="comment"> *\param netw NETWORK where add the message</span></div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment"> *\param msg  the message to add</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment"> *\return TRUE if success FALSE on error</span></div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502"> 1982</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *msg )</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;{</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( msg, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( msg -&gt; data, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                <span class="keywordflow">if</span>( msg -&gt; length &lt;= 0 )</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                {</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Empty messages are not supported. msg(%p)-&gt;lenght=%d&quot;</span>, msg, msg -&gt; length );</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                }</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="group___l_i_s_t.html#ga4eab319289a83524639ee5e9f0441fdf">list_push</a>( netw -&gt; send_buf, msg, <a class="code" href="group___n___s_t_r.html#ga0a864a4ce4997389f2e5e2e16c51a30a">free_nstr_ptr</a> ) == FALSE )</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;                }</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                sem_post( &amp;netw -&gt; send_blocker );</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;} <span class="comment">/* netw_add_msg(...) */</span></div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment">/*!\fn int netw_add_msg_ex( NETWORK *netw , char *str , unsigned int length )</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="comment"> *\brief Add a message to send in aimed NETWORK</span></div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment"> *\param netw NETWORK where add the message</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment"> *\param str  the message to add</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment"> *\param length  the size of the message to add</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment"> *\return TRUE if success FALSE on error</span></div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gafd17b2ed695976a31b4cdee5091e0ef7"> 2018</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gafd17b2ed695976a31b4cdee5091e0ef7">netw_add_msg_ex</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">char</span> *str, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length )</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;{</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( str, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                <span class="keywordflow">if</span>( length == 0 )</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                {</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                }</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *nstr = NULL ;</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( nstr, <a class="code" href="struct_n___s_t_r.html">N_STR</a>, 1 );</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( nstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                <span class="keywordflow">if</span>( length == 0 )</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                {</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Empty messages are not supported. msg(%p)-&gt;lenght=%d&quot;</span>, str, length );</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                }</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                nstr -&gt; data = str ;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                nstr -&gt; written = nstr -&gt; length = length ;</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="group___l_i_s_t.html#ga4eab319289a83524639ee5e9f0441fdf">list_push</a>( netw -&gt; send_buf, nstr, <a class="code" href="group___n___s_t_r.html#ga0a864a4ce4997389f2e5e2e16c51a30a">free_nstr_ptr</a> ) == FALSE )</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                {</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;                }</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;                sem_post( &amp;netw -&gt; send_blocker );</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;} <span class="comment">/* netw_add_msg_ex(...) */</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">/*!\fn N_STR *netw_get_msg( NETWORK *netw )</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;<span class="comment"> *\brief Get a message from aimed NETWORK</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment"> *\param netw NETWORK where get the msg</span></div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment"> *\return NULL or a filled N_STR</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02061"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga926ed3ffe3f89e679b412b059e20e1f1"> 2061</a></span>&#160;<a class="code" href="struct_n___s_t_r.html">N_STR</a> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga926ed3ffe3f89e679b412b059e20e1f1">netw_get_msg</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw )</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;{</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> * ptr = NULL ;</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                ptr = <a class="code" href="group___l_i_s_t.html#ga1109e1a0b5996fb3c362ad243e2f8f80">list_shift</a>( netw -&gt; recv_buf, <a class="code" href="struct_n___s_t_r.html">N_STR</a> );</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;                <span class="keywordflow">return</span> ptr ;</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;} <span class="comment">/* netw_get_msg(...)*/</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">/*!\fn N_STR *netw_wait_msg( NETWORK *netw , long refresh , long timeout )</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment"> *\brief Wait a message from aimed NETWORK. Recheck each usec until a valid</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment"> *\param netw The link on which we wait a message</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment"> *\param refresh The time in usec between each check until there is a message</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment"> *\param timeout in usecs , maximum amount of time to wait before return. Pass a value &lt;= 0 to disable.</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment"> *\return NULL or a filled N_STR</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga7fa831f66b706272d4001e866825e3bf"> 2085</a></span>&#160;<a class="code" href="struct_n___s_t_r.html">N_STR</a> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga7fa831f66b706272d4001e866825e3bf">netw_wait_msg</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">long</span> refresh, <span class="keywordtype">long</span> timeout )</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;{</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *nstrptr = NULL ;</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                <span class="keywordtype">int</span> timed = 0 ;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                <span class="keywordtype">long</span> secs = 0 ;</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                <span class="keywordtype">long</span> usecs = 0 ;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                usecs = refresh ;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                <span class="keywordflow">if</span>( refresh &gt; 999999 )</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                {</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                                secs = refresh / 1000000 ;</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                                usecs = refresh % 1000000 ;</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                }</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                <span class="keywordflow">if</span>( timeout &gt; 0 )</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                                timed = timeout ;</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                <span class="keywordtype">int</span> state = NETW_RUN, thr_state = 0 ;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                <span class="keywordflow">do</span></div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                {</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                                nstrptr = <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga926ed3ffe3f89e679b412b059e20e1f1">netw_get_msg</a>( netw );</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                                <span class="keywordflow">if</span>( nstrptr )</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                                                <span class="keywordflow">return</span> nstrptr ;</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                                <span class="keywordflow">if</span>( timed &gt; 0 )</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                                {</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                                                timeout -= refresh ;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                                                <span class="keywordflow">if</span>( timeout &lt; 0 )</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                                                {</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;timed out for netw %d (%s)&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ) );</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                                                                break ;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                                                }</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                                }</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                                <span class="keywordflow">if</span>(secs &gt; 0)</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                                                sleep( secs );</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                                <span class="keywordflow">if</span>( usecs &gt;0 )</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                                                <a class="code" href="group___n___t_i_m_e.html#ga690f12dde1a446d47b8bf5f959493003">u_sleep</a>( usecs );</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( netw, &amp;state, &amp;thr_state );</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                }</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                <span class="keywordflow">while</span>( state == NETW_RUN );</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                <span class="keywordflow">if</span>( timed &gt; 0 &amp;&amp; timeout &lt;= 0 )</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                {</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a> , <span class="stringliteral">&quot;netw %d state %s (%d): no message after waiting %ds&quot;</span> , netw -&gt; link . sock , N_ENUM_ENTRY(__netw_code_type,toString)(state) , state , timeout );</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                }</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                {</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a> , <span class="stringliteral">&quot;netw %d exited with state %s (%d)&quot;</span> , netw -&gt; link . sock , N_ENUM_ENTRY(__netw_code_type,toString)(state) , state , timeout );</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                }</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;} <span class="comment">/* netw_wait_msg(...) */</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">/*!\fn netw_start_thr_engine( NETWORK *netw )</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment"> *\brief Start the NETWORK netw Threaded Engine. Create a sending &amp; receiving thread.</span></div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment"> *\param netw The aimed NETWORK connection to start receiving data</span></div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;<span class="comment"> *\return TRUE on success FALSE on failure</span></div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga5ba0555c5ccd261227c3c1216923d563"> 2149</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga5ba0555c5ccd261227c3c1216923d563">netw_start_thr_engine</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw )</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;{</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                <span class="keywordflow">if</span>( netw -&gt; threaded_engine_status == NETW_THR_ENGINE_STARTED )</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                {</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;THR Engine already started for network %p (%s)&quot;</span>, netw, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ) );</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                }</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                <span class="keywordflow">if</span>( pthread_create(  &amp;netw -&gt; recv_thr,   NULL,  <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gad67570728a69ce2788b8bc9dcaa7c392">netw_recv_func</a>,  (<span class="keywordtype">void</span> *) netw ) != 0 )</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Unable to create recv_thread for network %p (%s)&quot;</span>, netw, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ) );</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                }</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                netw -&gt; nb_running_threads ++ ;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                <span class="keywordflow">if</span>( pthread_create(  &amp;netw -&gt; send_thr,   NULL,  <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa3c12701bdb3cd2e1adaa00981ca3cc8">netw_send_func</a>,  (<span class="keywordtype">void</span> *) netw ) != 0 )</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                {</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Unable to create send_thread for network %p (%s)&quot;</span>, netw, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ) );</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                }</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                netw -&gt; nb_running_threads ++ ;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                netw -&gt; threaded_engine_status = NETW_THR_ENGINE_STARTED ;</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;}  <span class="comment">/* netw_create_recv_thread(....) */</span></div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">/*!\fn void *netw_send_func( void *NET )</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment"> *\brief Thread send function</span></div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment"> *\param NET the NETWORK connection to use, casted into (void*)</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa3c12701bdb3cd2e1adaa00981ca3cc8"> 2189</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa3c12701bdb3cd2e1adaa00981ca3cc8">netw_send_func</a>( <span class="keywordtype">void</span> *NET )</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;{</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;                <span class="keywordtype">int</span> DONE = 0,</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;                                state = 0,</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;                                net_status = 0 ;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;                <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> nboctet = 0 ;</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                <span class="keywordtype">char</span> nboct[ 5 ] = <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *ptr = NULL ;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw = (<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *) NET ;</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                <span class="keywordflow">do</span></div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;                                <span class="comment">/* do not consume cpu for nothing, reduce delay */</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                                sem_wait( &amp;netw -&gt; send_blocker );</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;                                <span class="keywordtype">int</span> message_sent = 0 ;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                                <span class="keywordflow">while</span>( message_sent == 0 &amp;&amp; !DONE )</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                                {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( netw, &amp;state, NULL );</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                                                <span class="keywordflow">if</span>( state&amp;NETW_ERROR )</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                                                {</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                                                                DONE = 666 ;</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;                                                }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( state&amp;NETW_EXITED )</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                                                {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                                                                DONE = 100 ;</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                                                }</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( state&amp;NETW_EXIT_ASKED )</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                                                {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;                                                                DONE = 100 ;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                                                                <span class="comment">/* sending state */</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                                                                nboctet = htonl( NETW_EXIT_ASKED );</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                                                                memcpy( nboct, &amp;nboctet, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;%d Sending Quit !&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#ac6ee9581baa5e9d738641783c12684c8">send_data</a>( netw -&gt; link . sock, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                                                                                DONE = 4 ;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;%d Quit sent!&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                                                }</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                                                {</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                                                                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;                                                                ptr = <a class="code" href="group___l_i_s_t.html#ga1109e1a0b5996fb3c362ad243e2f8f80">list_shift</a>( netw -&gt; send_buf, <a class="code" href="struct_n___s_t_r.html">N_STR</a> ) ;</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;                                                                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                                                                <span class="keywordflow">if</span>( ptr &amp;&amp; ptr -&gt; length &gt; 0 &amp;&amp; ptr -&gt; data )</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;                                                                {</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Sending ptr size %d written %d&quot;</span>, ptr -&gt; length, ptr -&gt; written );</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;                                                                                <span class="comment">/* sending state */</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;                                                                                nboctet = htonl( state );</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;                                                                                memcpy( nboct, &amp;nboctet, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;                                                                                <span class="comment">/* sending state */</span></div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;                                                                                <span class="keywordflow">if</span> ( !DONE )</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                                                                                {</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                                                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#ac6ee9581baa5e9d738641783c12684c8">send_data</a>( netw -&gt; link . sock, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                                                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                                                                                                                DONE = 1 ;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                                                                                }</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                                                                                <span class="keywordflow">if</span>( !DONE )</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                                                                                {</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                                                                                                <span class="comment">/* sending number of octet */</span></div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                                                                                                nboctet = htonl( ptr -&gt; written );</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                                                                                                memcpy( nboct, &amp;nboctet, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                                                                                                <span class="comment">/* sending the number of octet to receive on next message */</span></div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                                                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#ac6ee9581baa5e9d738641783c12684c8">send_data</a>( netw -&gt; link . sock, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                                                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                                                                                                                DONE = 2 ;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                                                                                }</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                                                                                <span class="comment">/* sending the data itself */</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                                                                                <span class="keywordflow">if</span> ( !DONE )</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                                                                                {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                                                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#ac6ee9581baa5e9d738641783c12684c8">send_data</a>( netw -&gt; link . sock, ptr -&gt; data, ptr -&gt; written );</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                                                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                                                                                                                DONE = 3 ;</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                                                                                }</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                                                                                free_nstr( &amp;ptr );</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                                                                                <a class="code" href="group___n___t_i_m_e.html#ga690f12dde1a446d47b8bf5f959493003">u_sleep</a>(  netw -&gt; send_queue_consecutive_wait );</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                                                                                message_sent = 1 ;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                                                                }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                                                }</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                                }</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                }</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                <span class="keywordflow">while</span>( !DONE );</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                <span class="keywordflow">if</span>( DONE == 1 )</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when sending state %d on socket %d (%s), network: %s&quot;</span>, netw -&gt; state, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 2 )</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when sending number of octet to socket %d (%s), network: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 3 )</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;Error when sending data on socket %d (%s), network: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 4 )</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when sending state QUIT on socket %d (%s), network: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 5 )</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when sending state QUIT number of octet (0) on socket %d (%s), network: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;                <span class="keywordflow">if</span>( DONE == 100 )</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;                {</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Socket %d: Sending thread exiting correctly&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_EXIT_ASKED );</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;                }</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                {</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Socket %d (%s): Sending thread exiting with error %d !&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ),DONE );</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_ERROR );</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                }</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;                netw -&gt; nb_running_threads -- ;</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                pthread_exit( 0 );</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                <span class="comment">/* suppress compiler warning */</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;<span class="preprocessor">#if !defined( __linux__ ) </span></div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="preprocessor"></span>                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="preprocessor"></span>} <span class="comment">/* netw_send_func(...) */</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;<span class="comment">/*!\fn void *netw_recv_func( void *NET )</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;<span class="comment"> *\brief To Thread Receiving function</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;<span class="comment"> *\param NET the NETWORK connection to use</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gad67570728a69ce2788b8bc9dcaa7c392"> 2319</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gad67570728a69ce2788b8bc9dcaa7c392">netw_recv_func</a>( <span class="keywordtype">void</span> *NET )</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;{</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;                <span class="keywordtype">int</span> DONE = 0,</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;                                state = 0,</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;                                tmpstate = 0,</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                                net_status = 0 ;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> nboctet = 0 ;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                <span class="keywordtype">char</span> nboct[ 5 ]= <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *recvdmsg = NULL ;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw = (<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *) NET ;</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                <span class="keywordflow">do</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                {</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( netw, &amp;state, NULL );</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                                <span class="keywordflow">if</span>( state&amp;NETW_EXIT_ASKED || state&amp;NETW_EXITED )</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                                {</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                                                DONE = 100;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                                }</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                                <span class="keywordflow">if</span>( state&amp;NETW_ERROR )</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                                {</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                                                DONE = 666 ;</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                                }</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                                {</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                                                <span class="comment">/*if( !DONE &amp;&amp; !(state&amp;NETW_EXIT_ASKED) &amp;&amp; !(state&amp;NETW_EXITED) ) */</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                                                <span class="keywordflow">if</span>( !DONE )</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                                                {</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                                                                <span class="comment">/* receiving state */</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#afa4742a842c0f4e729d8a88371c49209">recv_data</a>( netw -&gt; link . sock, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                                                                {</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                                                                                DONE = 1 ;</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                                                                }</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                                                                {</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                                                                                memcpy( &amp;nboctet, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                                                                                tmpstate = ntohl( nboctet );</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                                                                                nboctet = tmpstate ;</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                                                                                <span class="keywordflow">if</span>( tmpstate==NETW_EXIT_ASKED )</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                                                                                {</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;%d receiving order to QUIT, nboctet %d NETW_EXIT_ASKED %d !&quot;</span>, netw -&gt; link . sock, nboctet, NETW_EXIT_ASKED );</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                                                                                                DONE = 100 ;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                                                                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_EXIT_ASKED );</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                                                                                }</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                                                                                {</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                                                                                                <span class="comment">/* receiving nboctet */</span></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                                                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#afa4742a842c0f4e729d8a88371c49209">recv_data</a>( netw -&gt; link . sock, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                                                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                                                                                                {</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                                                                                                                DONE = 2 ;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                                                                                                }</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                                                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                                                                                                {</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                                                                                                                memcpy( &amp;nboctet, nboct, <span class="keyword">sizeof</span>( <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> ) );</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                                                                                                                tmpstate = ntohl( nboctet );</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                                                                                                                nboctet = tmpstate ;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                                                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( recvdmsg, <a class="code" href="struct_n___s_t_r.html">N_STR</a>, 1 );</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                                                                                                                <span class="keywordflow">if</span>( !recvdmsg )</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                                                                                                                {</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;                                                                                                                                DONE = 3;</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                                                                                                                }</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                                                                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;                                                                                                                {</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                                                                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;%d octets to receive...&quot;</span>, nboctet );</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                                                                                                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( recvdmsg -&gt; data, <span class="keywordtype">char</span>, nboctet + 1 );</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                                                                                                                                <span class="keywordflow">if</span>( !recvdmsg -&gt; data )</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                                                                                                                                {</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                                                                                                                                                DONE = 4 ;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                                                                                                                                }</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                                                                                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;                                                                                                                                {</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                                                                                                                                                recvdmsg -&gt; length  = nboctet + 1 ;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                                                                                                                                                recvdmsg -&gt; written = nboctet ;</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                                                                                                                                                <span class="comment">/* receiving the data itself */</span></div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                                                                                                                                                net_status = netw-&gt;<a class="code" href="struct_n_e_t_w_o_r_k.html#afa4742a842c0f4e729d8a88371c49209">recv_data</a>( netw -&gt; link . sock, recvdmsg -&gt; data, nboctet );</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                                                                                                                                                <span class="keywordflow">if</span>( net_status &lt; 0 )</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                                                                                                                                                {</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                                                                                                                                                                DONE = 5 ;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                                                                                                                                                }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                                                                                                                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                                                                                                                                                {</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                                                                                                                                                                pthread_mutex_lock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                                                                                                                                                                <span class="keywordflow">if</span>( !DONE &amp;&amp; <a class="code" href="group___l_i_s_t.html#ga4eab319289a83524639ee5e9f0441fdf">list_push</a>( netw -&gt; recv_buf, recvdmsg, <a class="code" href="group___n___s_t_r.html#ga0a864a4ce4997389f2e5e2e16c51a30a">free_nstr_ptr</a> ) == FALSE )</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                                                                                                                                                                                DONE = 6 ;</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                                                                                                                                                                pthread_mutex_unlock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                                                                                                                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;%d octets received !&quot;</span>, nboctet );</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                                                                                                                                                } <span class="comment">/* recv data */</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                                                                                                                                } <span class="comment">/* recv data allocation */</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                                                                                                                } <span class="comment">/* recv struct allocation */</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                                                                                                } <span class="comment">/* recv nb octet*/</span></div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                                                                                } <span class="comment">/* exit asked */</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                                                                } <span class="comment">/* recv state */</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                                                } <span class="comment">/* if( !done) */</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                                } <span class="comment">/* if !exit */</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                }</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                <span class="keywordflow">while</span>( !DONE );</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                <span class="keywordflow">if</span>( DONE == 1 )</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when receiving state from socket %d (%s), net_status: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 2 )</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when receiving nboctet from socket %d (%s), net_status: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 3 )</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error when receiving data from socket %d (%s), net_status: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 4 )</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error allocating received message struct from socket %d (%s), net_status: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 5 )</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error allocating received messages data array from socket %d (%s), net_status: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DONE == 6 )</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Error adding receved message from socket %d (%s), net_status: %s&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), (net_status==-2)?<span class="stringliteral">&quot;disconnected&quot;</span>:<span class="stringliteral">&quot;socket error&quot;</span> );</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="keywordflow">if</span>( DONE == 100 )</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                {</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Socket %d (%s): Receive thread exiting correctly&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ) );</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_EXIT_ASKED );</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                }</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                {</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Socket %d (%s): Receive thread exiting with code %d !&quot;</span>, netw -&gt; link . sock, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( netw -&gt; link . ip ), DONE );</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_ERROR );</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                }</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                netw -&gt; nb_running_threads -- ;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; eventbolt );</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                pthread_exit( 0 );</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                <span class="comment">/* suppress compiler warning */</span></div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;<span class="preprocessor">#if !defined( __linux__ ) </span></div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;<span class="preprocessor"></span>                <span class="keywordflow">return</span> NULL ;</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;<span class="preprocessor"></span>} <span class="comment">/* netw_recv_func(...) */</span></div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;<span class="comment">/*!\fn netw_stop_thr_engine( NETWORK *netw )</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;<span class="comment"> *\brief Stop a NETWORK connection sending and receing thread</span></div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;<span class="comment"> *\param netw The aimed NETWORK conection to stop</span></div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;<span class="comment"> *\return TRUE on success FALSE on failure</span></div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga29159184519b3129c0154b1a2c2a3e2f"> 2470</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga29159184519b3129c0154b1a2c2a3e2f">netw_stop_thr_engine</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw )</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;{</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw,  <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                <span class="keywordtype">int</span> state = 0, thr_engine_status = 0 ;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;Network %d stop threads event&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a>( netw, &amp;state, &amp;thr_engine_status );</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                <span class="keywordflow">if</span>( thr_engine_status != NETW_THR_ENGINE_STARTED )</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                {</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Thread engine status already stopped for network %p&quot;</span>, netw );</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                }</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_EXIT_ASKED );</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;Network %d waits for send threads to stop&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                <span class="keywordflow">for</span>( <span class="keywordtype">int</span> it = 0 ; it &lt; 10 ; it ++ )</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                {</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                                sem_post( &amp;netw -&gt; send_blocker );</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                                usleep( 1000 );</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                }</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                pthread_join( netw -&gt; send_thr, NULL );</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;Network %d waits for recv threads to stop&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                pthread_join( netw -&gt; recv_thr, NULL );</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a>( netw, NETW_EXITED|NETW_THR_ENGINE_STOPPED );</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>,  <span class="stringliteral">&quot;Network %d threads Stopped !&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;} <span class="comment">/* Stop_Network( ... ) */</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="comment">/*!\fn send_data( SOCKET s , char *buf, NSTRBYTE n )</span></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="comment"> *\brief send data onto the socket</span></div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment"> *\param s connected socket</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;<span class="comment"> *\param buf pointer to buffer</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment"> *\param n number of characters we want to send</span></div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;<span class="comment"> *\return -1 on error, -2 on disconnection, n on success</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3dc736265484a58e6678c250e38cef8"> 2513</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3dc736265484a58e6678c250e38cef8">send_data</a>( SOCKET s, <span class="keywordtype">char</span> *buf, <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> n )</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;{</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( buf, <span class="keywordflow">return</span> -1 );</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;                <span class="keywordtype">int</span> bcount = 0 ; <span class="comment">/* counts bytes sent */</span></div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                <span class="keywordflow">if</span>( n == 0 )</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                {</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Send of 0 is unsupported.&quot;</span> );</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;                                <span class="keywordflow">return</span> -1 ;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;                }</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                <span class="keywordflow">while</span>( (<a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a>)bcount &lt; n )                 <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;                {</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;                                <span class="keywordtype">int</span> br = 0 ;     <span class="comment">/* bytes sent this pass */</span></div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;                                br = send( s, buf, n - bcount, NETFLAGS );</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;                                {</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;                                                bcount += br;                <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;                                                buf += br;                   <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;                                }</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;                                {</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;                                                <span class="keywordflow">if</span>( error == ECONNRESET || error == ENOTCONN )</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                                                {</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;socket %d disconnected !&quot;</span>, s );</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;                                                                <span class="keywordflow">return</span> -2 ;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                                                }</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Socket %d send Error: %d , %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;                                                <span class="keywordflow">return</span> -1 ;</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;                                }</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;                }</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;                <span class="keywordflow">return</span> bcount;</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;} <span class="comment">/*send_data(...)*/</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment">/*!\fn recv_data( SOCKET s , char *buf, NSTRBYTE n )</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="comment"> *\brief recv data from the socket</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="comment"> *\param s connected socket</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment"> *\param buf pointer to buffer</span></div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment"> *\param n number of characters we want</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment"> *\return -1 on error, -2 on disconnection n on success</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02563"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga1fc319fa3b0eba19e163070a9fb3dae4"> 2563</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga1fc319fa3b0eba19e163070a9fb3dae4">recv_data</a>( SOCKET s, <span class="keywordtype">char</span> *buf, <a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a> n )</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;{</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( buf, <span class="keywordflow">return</span> -1 );</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                <span class="keywordtype">int</span> bcount = 0 ; <span class="comment">/* counts bytes read */</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                <span class="keywordflow">if</span>( n == 0 )</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                {</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Recv of 0 is unsupported.&quot;</span> );</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                                <span class="keywordflow">return</span> -1 ;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                }</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                <span class="keywordflow">while</span>( (<a class="code" href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a>)bcount &lt; n )</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                                <span class="keywordtype">int</span> br = 0 ;     <span class="comment">/* bytes read this pass */</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                                <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gaf355f5fc76fc13a2bb894b92f7fb1ad9">CALL_RETRY</a>( br, recv( s, buf, n - bcount, NETFLAGS ) );</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                                {</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                                                bcount += br;                    <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                                                buf += br;                       <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                                }</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                                {</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                                                <span class="keywordflow">if</span>( br == 0 )</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                                                {</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;socket %d disconnected !&quot;</span>, s );</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                                                                <span class="keywordflow">return</span> -2 ;</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                                                }</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;socket %d recv returned %d, error: %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                                                <span class="keywordflow">return</span> -1 ;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                                }</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;                }</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;                <span class="keywordflow">return</span> bcount;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;} <span class="comment">/*recv_data(...)*/</span></div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;<span class="comment">/*!\fn int send_php( SOCKET s, int _code , char *buf, int n )</span></div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;<span class="comment"> *\brief send data onto the socket</span></div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;<span class="comment"> *\param s connected socket</span></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment"> *\param buf pointer to buffer</span></div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;<span class="comment"> *\param n number of characters we want to send</span></div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;<span class="comment"> *\param _code Code for php decoding rule</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;<span class="comment"> *\return -1 on error, n on success</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div>
<div class="line"><a name="l02621"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga0f3aa54a82aed45e85124acbd7af6a29"> 2621</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga0f3aa54a82aed45e85124acbd7af6a29">send_php</a>( SOCKET s, <span class="keywordtype">int</span> _code, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> n )</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;{</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;                <span class="keywordtype">int</span> bcount = 0 ;   <span class="comment">/* counts bytes read */</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                <span class="keywordtype">int</span> br = 0 ;       <span class="comment">/* bytes read this pass */</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                <span class="keywordtype">char</span> *ptr = NULL ; <span class="comment">/* temp char ptr ;-) */</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;                <span class="keywordtype">char</span> tmpstr[ HEAD_SIZE +1 ] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                <span class="keywordtype">char</span> head[ HEAD_SIZE +1 ] = <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                <span class="keywordtype">char</span> code[ HEAD_CODE +1 ] = <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                snprintf( tmpstr, HEAD_SIZE + 1, <span class="stringliteral">&quot;%%0%dd&quot;</span>, HEAD_SIZE );</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                snprintf( head, HEAD_SIZE + 1, tmpstr, n );</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                snprintf( tmpstr, HEAD_SIZE + 1, <span class="stringliteral">&quot;%%0%dd&quot;</span>, HEAD_CODE );</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                snprintf( code, HEAD_CODE + 1, tmpstr, _code );</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                <span class="comment">/* sending head */</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                bcount = br = 0 ;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                ptr = head ;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                <span class="keywordflow">while</span> ( bcount &lt; HEAD_SIZE )                 <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                {</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gaf355f5fc76fc13a2bb894b92f7fb1ad9">CALL_RETRY</a>( br, send( s, head, HEAD_SIZE - bcount, NETFLAGS ) );</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                                {</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                                                bcount += br;                <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                                                ptr += br;                   <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                                }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                                {</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Socket %d sending Error %d when sending head size, neterrno: %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                                }</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                }</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                <span class="comment">/* sending code */</span></div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                bcount = br = 0 ;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                ptr = code ;</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                <span class="keywordflow">while</span> ( bcount &lt; HEAD_CODE )                 <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                                br = send( s, code, HEAD_CODE - bcount, NETFLAGS );</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                                {</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                                                bcount += br;                <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                                                ptr += br;                   <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                                }</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                                {</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>,  <span class="stringliteral">&quot;Socket %d sending Error %d when sending head code, neterrno: %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;                                }</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;                }</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                <span class="comment">/* sending buf */</span></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;                bcount = 0;</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                br = 0;</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;                <span class="keywordflow">while</span> ( bcount &lt; n )                 <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;                {</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;                                br = send( s, buf, n - bcount, NETFLAGS );</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                                {</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                                                bcount += br;                <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                                                buf += br;                   <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                                }</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                                {</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Socket %d sending Error %d when sending message of size %d, neterrno: %S&quot;</span>, s, br, n, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;                                }</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                }</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;                <span class="keywordflow">return</span> bcount;</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;} <span class="comment">/*send_php(...)*/</span></div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="comment">/*!\fn int recv_php( SOCKET s, int *_code , char **buf )</span></div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;<span class="comment"> *\brief recv data from the socket</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<span class="comment"> *\param s connected socket</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment"> *\param _code pointer to store the code</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="comment"> *\param buf pointer to buffer</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="comment"> *\return -1 on error, size on success</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3e1619c354974bd6a40b511b2896e60"> 2720</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3e1619c354974bd6a40b511b2896e60">recv_php</a>( SOCKET s, <span class="keywordtype">int</span> *_code, <span class="keywordtype">char</span> **buf )</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;{</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;                <span class="keywordtype">int</span> bcount = 0 ; <span class="comment">/* counts bytes read */</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                <span class="keywordtype">int</span> br = 0 ;     <span class="comment">/* bytes read this pass */</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;                <span class="keywordtype">long</span> <span class="keywordtype">int</span> tmpnb = 0, size = 0 ;    <span class="comment">/* size of message to receive */</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                <span class="keywordtype">char</span> *ptr = NULL ;</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                <span class="keywordtype">int</span> error = 0 ;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;                <span class="keywordtype">char</span> *errmsg = NULL ;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;                <span class="keywordtype">char</span> head[ HEAD_SIZE + 1 ] = <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                <span class="keywordtype">char</span> code[ HEAD_CODE + 1]  = <span class="stringliteral">&quot;&quot;</span> ;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;                <span class="comment">/* Receiving total message size */</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                bcount = br = 0 ;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                ptr = head;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;                <span class="keywordflow">while</span> ( bcount &lt; HEAD_SIZE )</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                {</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                                <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                                br = recv( s, ptr, HEAD_SIZE - bcount, NETFLAGS );</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                                {</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;                                                bcount += br;                    <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                                                ptr += br;                       <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;                                }</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                                {</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;                                                <span class="keywordflow">if</span>( br == 0 &amp;&amp; bcount == ( HEAD_SIZE - bcount ) )</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;                                                                break ;</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Socket %d receive %d Error %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                                }</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                }</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                tmpnb = strtol( head, NULL, 10 );</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                <span class="keywordflow">if</span>( tmpnb == LONG_MIN || tmpnb == LONG_MAX )</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                {</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Size received ( %ld ) can not be determined on socket %d&quot;</span>, tmpnb, s );</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                }</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                size = tmpnb ;</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;                <span class="comment">/* receiving request code */</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;                bcount = br = 0 ;</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;                ptr = code;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;                <span class="keywordflow">while</span> ( bcount &lt; HEAD_CODE )</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;                {</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                                <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;                                br = recv( s, ptr, HEAD_CODE - bcount, NETFLAGS );</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;                                {</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;                                                bcount += br;                    <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;                                                ptr += br;                       <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;                                }</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;                                {</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                                                <span class="keywordflow">if</span>( br == 0 &amp;&amp; bcount == ( HEAD_CODE - bcount ) )</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                                                                break ;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Socket %d receive %d Error , neterrno: %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                                }</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;                }</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;                tmpnb = strtol( code, NULL, 10 );</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;                <span class="keywordflow">if</span>( tmpnb == LONG_MIN || tmpnb == LONG_MAX )</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                {</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Code received ( %ld ) can not be determined on socket %d\n&quot;</span>, tmpnb, s );</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;                }</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;                (*_code) = tmpnb ;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;                <span class="comment">/* receving message */</span></div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                <span class="keywordflow">if</span>( (*buf ) )</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( (*buf ) );</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                }</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( (*buf), <span class="keywordtype">char</span>, (size+1) );</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                <span class="keywordflow">if</span>( !(*buf ) )</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                {</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Could not allocate PHP receive buf&quot;</span> );</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                }</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                bcount = 0;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                br = 0;</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                ptr = (*buf);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                <span class="keywordflow">while</span> ( bcount &lt; size )</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                {</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                                <span class="comment">/* loop until full buffer */</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                                br = recv( s, ptr, size - bcount, NETFLAGS );</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                                error = neterrno ;</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                                <span class="keywordflow">if</span>( br &gt; 0 )</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                                {</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                                                bcount += br;                    <span class="comment">/* increment byte counter */</span></div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;                                                ptr += br;                       <span class="comment">/* move buffer ptr for next read */</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;                                }</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                                {</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                                                <span class="keywordflow">if</span>( br == 0 &amp;&amp; bcount == ( size - bcount ) )</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                                                                break ;</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                                                <span class="comment">/* signal an error to the caller */</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                                                errmsg = netstrerror( error );</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Socket %d receive %d Error neterrno: %s&quot;</span>, s, br, <a class="code" href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a>( errmsg ) );</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a>( errmsg );</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;                                                <span class="keywordflow">return</span> FALSE;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                                }</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                }</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                <span class="keywordflow">return</span> size ;</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;} <span class="comment">/*recv_php(...)*/</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment">/*!\fn int netw_get_queue_status( NETWORK *netw, int *nb_to_send, int *nb_to_read )</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="comment"> *\brief retrieve network send queue status</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<span class="comment"> *\param netw NETWORK object</span></div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;<span class="comment"> *\param nb_to_send Number of messages still in send buffer (not yet submitted to kernel)</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;<span class="comment"> *\param nb_to_read Number of message already read by the kernel, waiting in the local message list</span></div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga7db2f701ab9a20af4a6fa8baac9d5172"> 2850</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga7db2f701ab9a20af4a6fa8baac9d5172">netw_get_queue_status</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> *nb_to_send, <span class="keywordtype">int</span> *nb_to_read )</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;{</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;</div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;                (*nb_to_send) = netw -&gt; send_buf -&gt; nb_items ;</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; sendbolt );</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;                pthread_mutex_lock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;                (*nb_to_read) = netw -&gt; recv_buf -&gt; nb_items ;</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;                pthread_mutex_unlock( &amp;netw -&gt; recvbolt );</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;} <span class="comment">/* get queue states */</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="comment">/*!\fn NETWORK_POOL *netw_new_pool( int nb_min_element )</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;<span class="comment"> *\brief return a new network pool of nb_min_element</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="comment"> *\return a new NETWORK_POOL or NULL</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga817b624c75a82f4e1d0db734916bd921"> 2872</a></span>&#160;<a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *<a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga817b624c75a82f4e1d0db734916bd921">netw_new_pool</a>( <span class="keywordtype">int</span> nb_min_element )</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;{</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;                <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *netw_pool = NULL ;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a>( netw_pool, <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a>, 1 );</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool, <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;                netw_pool -&gt; pool = new_ht( nb_min_element );</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool -&gt; pool, <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( netw_pool ) ; <span class="keywordflow">return</span> NULL );</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga0499ff5244b948781a28466e35282c55">init_lock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;                <span class="keywordflow">return</span> netw_pool ;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;} <span class="comment">/* netw_new_pool() */</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="comment">/*!\fn int netw_destroy_pool( NETWORK_POOL **netw_pool )</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="comment"> *\brief free a network pool</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="comment"> *\param the address of a pointer to free</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#ga5c0996a0b85b32d296c4e679a6eb86c2"> 2894</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga5c0996a0b85b32d296c4e679a6eb86c2">netw_destroy_pool</a>(  <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> **netw_pool )</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;{</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool&amp;&amp;(*netw_pool), <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gabf9cebcdf845c2c9b879a608be4c9dce">write_lock</a>( (*netw_pool) -&gt; rwlock );</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                <span class="keywordflow">if</span>( (*netw_pool) -&gt; pool )</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                                <a class="code" href="group___h_a_s_h___t_a_b_l_e.html#ga22a943135dbcdb1611b40ce0547111ce">destroy_ht</a>( &amp;(*netw_pool) -&gt; pool );</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( (*netw_pool) -&gt; rwlock );</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga68d60dda02e374e8d2e38deb9aecadcd">rw_lock_destroy</a>( (*netw_pool) -&gt; rwlock );</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a>( (*netw_pool) );</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;} <span class="comment">/* netw_destroy_pool() */</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="keywordtype">void</span> netw_pool_netw_close( <span class="keywordtype">void</span> *netw_ptr )</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;{</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;                <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw = (<a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *)netw_ptr ;</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> );</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Network pool %p: network id %d still active !!&quot;</span>, netw, netw -&gt; link . sock );</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                return ;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;}</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="comment">/* add network to pool */</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="keywordtype">int</span> netw_pool_add( <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *netw_pool, <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw )</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;{</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Trying to add %lld to %p&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)netw -&gt; link . sock, netw_pool -&gt; pool );</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;                <span class="comment">/* write lock the pool */</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gabf9cebcdf845c2c9b879a608be4c9dce">write_lock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;                <span class="comment">/* test if not already added */</span></div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *key = NULL ;</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                <a class="code" href="group___n___s_t_r.html#ga1c1f4062c727970a68bfd932c3fabcd5">nstrprintf</a>( key, <span class="stringliteral">&quot;%lld&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)netw -&gt; link . sock );</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;                <a class="code" href="struct_h_a_s_h___n_o_d_e.html">HASH_NODE</a> *node = NULL ;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;                <span class="keywordflow">if</span>( ht_get_ptr( netw_pool -&gt; pool, <a class="code" href="group___c_o_m_m_o_n_s.html#gaf0e29edead3f943a4ac241c5724e1384">_nstr</a>( key ), (<span class="keywordtype">void</span> *)&amp;node ) == TRUE )</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                {</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Network id %d already added !&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;                                free_nstr( &amp;key );</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;                                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;                }</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                <span class="comment">/* add it */</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;                <span class="keywordtype">int</span> retval = ht_put_ptr( netw_pool -&gt; pool, <a class="code" href="group___c_o_m_m_o_n_s.html#gaf0e29edead3f943a4ac241c5724e1384">_nstr</a>( key ), netw, &amp;netw_pool_netw_close );</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                free_nstr( &amp;key );</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;                <a class="code" href="group___l_i_s_t.html#ga4eab319289a83524639ee5e9f0441fdf">list_push</a>( netw -&gt; pools, netw_pool, NULL );</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                <span class="comment">/* unlock the pool */</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;                <span class="keywordflow">return</span> retval ;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;} <span class="comment">/* netw_pool_add */</span></div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="comment">/* remove network to pool */</span></div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="keywordtype">int</span> netw_pool_remove( <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *netw_pool, <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw )</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;{</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                <span class="comment">/* write lock the pool */</span></div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gabf9cebcdf845c2c9b879a608be4c9dce">write_lock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                <span class="comment">/* test if present */</span></div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *key = NULL ;</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                <a class="code" href="group___n___s_t_r.html#ga1c1f4062c727970a68bfd932c3fabcd5">nstrprintf</a>( key, <span class="stringliteral">&quot;%lld&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)netw -&gt; link . sock );</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                <span class="keywordflow">if</span>( ht_remove( netw_pool -&gt; pool, <a class="code" href="group___c_o_m_m_o_n_s.html#gaf0e29edead3f943a4ac241c5724e1384">_nstr</a>( key ) ) == TRUE )</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;                {</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                                <a class="code" href="struct_l_i_s_t___n_o_d_e.html">LIST_NODE</a> *node = <a class="code" href="group___l_i_s_t.html#ga9be40eafc3444fd2443cc940634af163">list_search</a>( netw -&gt; pools, netw );</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                                <span class="keywordflow">if</span>( node )</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                                {</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                                                <span class="keywordflow">if</span>( !<a class="code" href="group___l_i_s_t.html#ga366776cfa85e526b247ef1d348c34e0c">remove_list_node</a>( netw -&gt; pools, node, <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> ) )</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                                                {</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                                                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Network id %d could not be removed !&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                                                }</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                                }</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Network id %d removed !&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;                                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                }</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                free_nstr( &amp;key );</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                <a class="code" href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a>( <a class="code" href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a>, <span class="stringliteral">&quot;Network id %d already removed !&quot;</span>, netw -&gt; link . sock );</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                <span class="comment">/* unlock the pool */</span></div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                <span class="keywordflow">return</span> FALSE ;</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;} <span class="comment">/* netw_pool_remove */</span></div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;<span class="comment">/* add message to pool */</span></div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;<span class="keywordtype">int</span> netw_pool_broadcast( <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *netw_pool, <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *from, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *net_msg )</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;{</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( net_msg, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                <span class="comment">/* write lock the pool */</span></div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gaeba0ec63ec0aa6803e9a601b645b5cbf">read_lock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;                <a class="code" href="group___h_a_s_h___t_a_b_l_e.html#ga072f117e6bd9fdde0d39776764b8784e">ht_foreach</a>( node , netw_pool -&gt; pool )</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                {</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                                <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw = <a class="code" href="group___h_a_s_h___t_a_b_l_e.html#gaeb031d4f0f896b1802b9c27e62f28d14">hash_val</a>( node, <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> );</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                                <span class="keywordflow">if</span>( from )</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                                {</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;                                                <span class="keywordflow">if</span>( netw -&gt; link . sock != from -&gt; link . sock )</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, <a class="code" href="group___n___s_t_r.html#gab9f1902d941f4f847a1063fd6fedd1f2">nstrdup</a>( net_msg ) );</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;                                }</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;                                {</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;                                                <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, <a class="code" href="group___n___s_t_r.html#gab9f1902d941f4f847a1063fd6fedd1f2">nstrdup</a>( net_msg ) );</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                                }</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;                }</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;} <span class="comment">/* netw_pool_broadcast */</span></div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;<span class="comment">/* get nb clients */</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;<span class="keywordtype">int</span> netw_pool_nbclients( <a class="code" href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a> *netw_pool )</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;{</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw_pool, <span class="keywordflow">return</span> -1 );</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                <span class="keywordtype">int</span> nb = -1 ;</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#gaeba0ec63ec0aa6803e9a601b645b5cbf">read_lock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                nb = netw_pool -&gt; pool -&gt; nb_keys ;</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a>( netw_pool -&gt; rwlock );</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                <span class="keywordflow">return</span> nb ;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;}</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment">/* set user id on a netw */</span></div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="keywordtype">int</span> netw_set_user_id( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> <span class="keywordtype">id</span> )</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;{</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;                netw -&gt; user_id = id ;</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                <span class="keywordflow">return</span> TRUE ;</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;}</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment">/*!\fn netw_send_ping( NETWORK *netw , int id_from , int id_to , int time , int type )</span></div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment"> *\brief Add a ping reply to the network</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment"> *\param netw The aimed NETWORK where we want to add something to send</span></div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment"> *\param id_from Identifiant of the sender</span></div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment"> *\param id_to Identifiant of the destination, -1 if the serveur itslef is targetted</span></div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment"> *\param time The time it was when the ping was sended</span></div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment"> *\param type NETW_PING_REQUEST or NETW_PING_REPLY</span></div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03050"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gad9588cf27263ecf40f57d3923ccf721a"> 3050</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gad9588cf27263ecf40f57d3923ccf721a">netw_send_ping</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> id_from, <span class="keywordtype">int</span> id_to, <span class="keywordtype">int</span> time )</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;{</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *tmpstr = NULL ;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;                tmpstr = <a class="code" href="group___n_e_t_w_o_r_k___m_s_g.html#ga7f3f5196c913ef29d775d3fbbcaeb476">netmsg_make_ping</a>( type, id_from, id_to, time );</div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( tmpstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, tmpstr );</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;} <span class="comment">/* netw_send_ping( ... ) */</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;<span class="comment">/*!\fn int netw_send_ident( NETWORK *netw , int type , int id , N_STR *name , N_STR *passwd  )</span></div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;<span class="comment"> *\brief Add a formatted NETWMSG_IDENT message to the specified network</span></div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;<span class="comment"> *\param netw The aimed NETWORK where we want to add something to send</span></div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="comment"> *\param type type of identification ( NETW_IDENT_REQUEST , NETW_IDENT_NEW )</span></div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment"> *\param id The ID of the sending client</span></div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment"> *\param name Username</span></div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment"> *\param passwd Password</span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gae8345266fcf7a23c0e8ffe176b0e086f"> 3072</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gae8345266fcf7a23c0e8ffe176b0e086f">netw_send_ident</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *name, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *passwd  )</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;{</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *tmpstr = NULL ;</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;                tmpstr = <a class="code" href="group___n_e_t_w_o_r_k___m_s_g.html#gacbebab8f754ea1a2e225dee3a164e2d8">netmsg_make_ident</a>( type, <span class="keywordtype">id</span>, name, passwd  );</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( tmpstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, tmpstr );</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;} <span class="comment">/* netw_send_ident( ... ) */</span></div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment">/*!\fn netw_send_position( NETWORK *netw , int id , double X , double Y , double vx , double vy , double acc_x , double acc_y , int time_stamp )</span></div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment"> *\brief Add a formatted NETWMSG_IDENT message to the specified network</span></div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment"> *\param netw The aimed NETWORK where we want to add something to send</span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment"> *\param id The ID of the sending client</span></div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment"> *\param X X position inside a big grid</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="comment"> *\param Y Y position inside a big grid</span></div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment"> *\param vx X speed</span></div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="comment"> *\param vy Y speed</span></div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="comment"> *\param acc_x Y acceleration</span></div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment"> *\param acc_y X acceleration</span></div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment"> *\param time_stamp Current Time when sending (for some delta we would want to compute )</span></div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03099"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gafaf1202a5f56a9f2285fccfbcacb3a6c"> 3099</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gafaf1202a5f56a9f2285fccfbcacb3a6c">netw_send_position</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">double</span> X, <span class="keywordtype">double</span> Y, <span class="keywordtype">double</span> vx, <span class="keywordtype">double</span> vy, <span class="keywordtype">double</span> acc_x, <span class="keywordtype">double</span> acc_y, <span class="keywordtype">int</span> time_stamp )</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;{</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *tmpstr = NULL ;</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                tmpstr = netmsg_make_position_msg(  <span class="keywordtype">id</span>, X, Y, vx, vy, acc_x, acc_y, time_stamp );</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( tmpstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, tmpstr );</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;} <span class="comment">/* netw_send_position( ... ) */</span></div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="comment">/*!\fn int netw_send_string_to( NETWORK *netw , int id_to , N_STR *name , N_STR *txt , int color )</span></div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="comment"> *\brief Add a string to the network, aiming a specific user</span></div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="comment"> *\param netw The aimed NETWORK where we want to add something to send</span></div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;<span class="comment"> *\param id_from The ID of the sending client</span></div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment"> *\param id_to The ID of the targetted client</span></div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="comment"> *\param name Sender Name</span></div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;<span class="comment"> *\param txt Sender text</span></div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;<span class="comment"> *\param color Sender text color</span></div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;<span class="keywordtype">int</span> netw_send_string_to( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <span class="keywordtype">int</span> id_to, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *name, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *chan, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *txt, <span class="keywordtype">int</span> color )</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;{</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *tmpstr = NULL ;</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;                tmpstr = netmsg_make_string_msg( netw -&gt; user_id, id_to, name, chan, txt, color );</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( tmpstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, tmpstr );</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;} <span class="comment">/* netw_send_string_to( ... ) */</span></div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="comment">/*!\fn netw_send_string_to_all( NETWORK *netw , int id , char *name , char *chan , char *txt , int color )</span></div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;<span class="comment"> *\brief Add a string to the network, aiming all server-side users</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="comment"> *\param netw The aimed NETWORK where we want to add something to send</span></div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="comment"> *\param id The ID of the sending client</span></div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="comment"> *\param name Name of user</span></div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="comment"> *\param chan Target Channel, if any. Pass &quot;ALL&quot; to target the default channel</span></div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="comment"> *\param txt The text to send</span></div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="comment"> *\param color The color of the text</span></div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="comment"> *\return TRUE or FALSE;</span></div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;<span class="keywordtype">int</span> netw_send_string_to_all( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *name, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *chan, <a class="code" href="struct_n___s_t_r.html">N_STR</a> *txt, <span class="keywordtype">int</span> color )</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;{</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *tmpstr = NULL ;</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;                tmpstr = netmsg_make_string_msg( netw -&gt; user_id,  -1, name, chan, txt, color );</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( tmpstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, tmpstr );</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;} <span class="comment">/* netw_send_string_to_all( ... ) */</span></div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="comment">/*!\fn int netw_send_quit( NETWORK *netw )</span></div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="comment"> *\brief Add a formatted NETMSG_QUIT message to the specified network</span></div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<span class="comment"> *\param netw The aimed NETWORK</span></div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;<span class="comment"> *\return TRUE or FALSE</span></div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l03168"></a><span class="lineno"><a class="line" href="group___n_e_t_w_o_r_k_i_n_g.html#gac8b30599c7a5c2cce35ee401d7b9d7f1"> 3168</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#gac8b30599c7a5c2cce35ee401d7b9d7f1">netw_send_quit</a>( <a class="code" href="struct_n_e_t_w_o_r_k.html">NETWORK</a> *netw )</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;{</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( netw, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;                <a class="code" href="struct_n___s_t_r.html">N_STR</a> *tmpstr = NULL ;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;                tmpstr = netmsg_make_quit_msg();</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;                <a class="code" href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a>( tmpstr, <span class="keywordflow">return</span> FALSE );</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a>( netw, tmpstr );</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;} <span class="comment">/* netw_send_quit( ... ) */</span></div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;</div>
<div class="ttc" id="group___l_i_s_t_html_ga55cdaac0dd0f4f4d687607e6679a4634"><div class="ttname"><a href="group___l_i_s_t.html#ga55cdaac0dd0f4f4d687607e6679a4634">list_foreach</a></div><div class="ttdeci">#define list_foreach(__ITEM_, __LIST_)</div><div class="ttdoc">ForEach macro helper. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8h_source.html#l00070">n_list.h:70</a></div></div>
<div class="ttc" id="struct_h_a_s_h___n_o_d_e_html"><div class="ttname"><a href="struct_h_a_s_h___n_o_d_e.html">HASH_NODE</a></div><div class="ttdoc">structure of a hash table node </div><div class="ttdef"><b>Definition:</b> <a href="n__hash_8h_source.html#l00083">n_hash.h:83</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_gaa82751b4d6a219771661843e61cefa2e"><div class="ttname"><a href="group___l_i_s_t.html#gaa82751b4d6a219771661843e61cefa2e">new_generic_list</a></div><div class="ttdeci">LIST * new_generic_list(int max_items)</div><div class="ttdoc">Initialiaze a generic list container to max_items pointers. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8c_source.html#l00020">n_list.c:20</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga46bf052fc99248347a1dcf89bc0757c6"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga46bf052fc99248347a1dcf89bc0757c6">Malloc</a></div><div class="ttdeci">#define Malloc(__ptr, __struct, __size)</div><div class="ttdoc">Malloc Handler to get errors and set to 0. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00180">n_common.h:180</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gafaf1202a5f56a9f2285fccfbcacb3a6c"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gafaf1202a5f56a9f2285fccfbcacb3a6c">netw_send_position</a></div><div class="ttdeci">int netw_send_position(NETWORK *netw, int id, double X, double Y, double vx, double vy, double acc_x, double acc_y, int time_stamp)</div><div class="ttdoc">Add a formatted NETWMSG_IDENT message to the specified network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l03099">n_network.c:3099</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaa8e1fe7978995197f08aa0ef24a76c33"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaa8e1fe7978995197f08aa0ef24a76c33">netw_set</a></div><div class="ttdeci">int netw_set(NETWORK *netw, int flag)</div><div class="ttdoc">Restart or reset the specified network ability. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01420">n_network.c:1420</a></div></div>
<div class="ttc" id="group___n___t_i_m_e_html_ga690f12dde1a446d47b8bf5f959493003"><div class="ttname"><a href="group___n___t_i_m_e.html#ga690f12dde1a446d47b8bf5f959493003">u_sleep</a></div><div class="ttdeci">void u_sleep(unsigned int usec)</div><div class="ttdoc">wrapper around usleep for API consistency </div><div class="ttdef"><b>Definition:</b> <a href="n__time_8c_source.html#l00038">n_time.c:38</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_ga4eab319289a83524639ee5e9f0441fdf"><div class="ttname"><a href="group___l_i_s_t.html#ga4eab319289a83524639ee5e9f0441fdf">list_push</a></div><div class="ttdeci">int list_push(LIST *list, void *ptr, void(*destructor)(void *ptr))</div><div class="ttdoc">Add a pointer to the end of the list. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8c_source.html#l00121">n_list.c:121</a></div></div>
<div class="ttc" id="group___l_o_g_html_gaeb4f36db01bd128c7afeac5889dac311"><div class="ttname"><a href="group___l_o_g.html#gaeb4f36db01bd128c7afeac5889dac311">LOG_INFO</a></div><div class="ttdeci">#define LOG_INFO</div><div class="ttdoc">informational </div><div class="ttdef"><b>Definition:</b> <a href="n__log_8h_source.html#l00063">n_log.h:63</a></div></div>
<div class="ttc" id="n__network_8h_html"><div class="ttname"><a href="n__network_8h.html">n_network.h</a></div><div class="ttdoc">Network Engine. </div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga817b624c75a82f4e1d0db734916bd921"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga817b624c75a82f4e1d0db734916bd921">netw_new_pool</a></div><div class="ttdeci">NETWORK_POOL * netw_new_pool(int nb_min_element)</div><div class="ttdoc">return a new network pool of nb_min_element </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02872">n_network.c:2872</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_gaf355f5fc76fc13a2bb894b92f7fb1ad9"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#gaf355f5fc76fc13a2bb894b92f7fb1ad9">CALL_RETRY</a></div><div class="ttdeci">#define CALL_RETRY(retvar, expression)</div><div class="ttdoc">TEMP_FAILURE gnu macro portable version. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00268">n_common.h:268</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_gabf9cebcdf845c2c9b879a608be4c9dce"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#gabf9cebcdf845c2c9b879a608be4c9dce">write_lock</a></div><div class="ttdeci">#define write_lock(__rwlock_mutex)</div><div class="ttdoc">Macro for acquiring a write lock on a rwlock mutex. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00375">n_common.h:375</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga52afd4f5662c9c8f334d224ae2cdbdf2"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga52afd4f5662c9c8f334d224ae2cdbdf2">netw_make_listening</a></div><div class="ttdeci">int netw_make_listening(NETWORK **netw, char *addr, char *port, int nbpending, int ip_version)</div><div class="ttdoc">Make a NETWORK be a Listening network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01684">n_network.c:1684</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga995d9aaabaca026d79f15a9823eaebaf"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga995d9aaabaca026d79f15a9823eaebaf">netw_wait_close_timed</a></div><div class="ttdeci">int netw_wait_close_timed(NETWORK **netw, int timeout)</div><div class="ttdoc">Wait for peer closing a specified Network, destroy queues, free the structure. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01606">n_network.c:1606</a></div></div>
<div class="ttc" id="group___n___s_t_r_html_ga1c1f4062c727970a68bfd932c3fabcd5"><div class="ttname"><a href="group___n___s_t_r.html#ga1c1f4062c727970a68bfd932c3fabcd5">nstrprintf</a></div><div class="ttdeci">#define nstrprintf(__nstr_var,...)</div><div class="ttdoc">Macro to quickly allocate and sprintf to N_STR *. </div><div class="ttdef"><b>Definition:</b> <a href="n__str_8h_source.html#l00097">n_str.h:97</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gad02f949dd057ae7dd382f03f9364cac0"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gad02f949dd057ae7dd382f03f9364cac0">netw_set_blocking</a></div><div class="ttdeci">int netw_set_blocking(NETWORK *netw, unsigned long int is_blocking)</div><div class="ttdoc">Modify blocking socket mode. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l00806">n_network.c:806</a></div></div>
<div class="ttc" id="group___l_o_g_html_ga61355655c6d490cdf201afdfc340df4b"><div class="ttname"><a href="group___l_o_g.html#ga61355655c6d490cdf201afdfc340df4b">n_log</a></div><div class="ttdeci">#define n_log(__LEVEL__,...)</div><div class="ttdoc">Logging function wrapper to get line and func. </div><div class="ttdef"><b>Definition:</b> <a href="n__log_8h_source.html#l00073">n_log.h:73</a></div></div>
<div class="ttc" id="group___n___s_t_r_html_ga555af8dd48b4cd567551bf0e13f982c8"><div class="ttname"><a href="group___n___s_t_r.html#ga555af8dd48b4cd567551bf0e13f982c8">NSTRBYTE</a></div><div class="ttdeci">int32_t NSTRBYTE</div><div class="ttdoc">N_STR base unit. </div><div class="ttdef"><b>Definition:</b> <a href="n__str_8h_source.html#l00145">n_str.h:145</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaa5ed966d8c5844ded549eda41e38c0be"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaa5ed966d8c5844ded549eda41e38c0be">netw_setsockopt</a></div><div class="ttdeci">int netw_setsockopt(NETWORK *netw, int optname, int value)</div><div class="ttdoc">Modify common socket options on the given netw. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l00866">n_network.c:866</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga1fc319fa3b0eba19e163070a9fb3dae4"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga1fc319fa3b0eba19e163070a9fb3dae4">recv_data</a></div><div class="ttdeci">int recv_data(SOCKET s, char *buf, NSTRBYTE n)</div><div class="ttdoc">recv data from the socket </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02563">n_network.c:2563</a></div></div>
<div class="ttc" id="struct_n_e_t_w_o_r_k_html"><div class="ttname"><a href="struct_n_e_t_w_o_r_k.html">NETWORK</a></div><div class="ttdoc">Structure of a NETWORK. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8h_source.html#l00260">n_network.h:260</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga926ed3ffe3f89e679b412b059e20e1f1"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga926ed3ffe3f89e679b412b059e20e1f1">netw_get_msg</a></div><div class="ttdeci">N_STR * netw_get_msg(NETWORK *netw)</div><div class="ttdoc">Get a message from aimed NETWORK. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02061">n_network.c:2061</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaf3e1619c354974bd6a40b511b2896e60"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3e1619c354974bd6a40b511b2896e60">recv_php</a></div><div class="ttdeci">int recv_php(SOCKET s, int *_code, char **buf)</div><div class="ttdoc">recv data from the socket </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02720">n_network.c:2720</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_ga1dafe7a250ddad51fadd375f057287e7"><div class="ttname"><a href="group___l_i_s_t.html#ga1dafe7a250ddad51fadd375f057287e7">list_empty</a></div><div class="ttdeci">int list_empty(LIST *list)</div><div class="ttdoc">Empty a LIST list of pointers. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8c_source.html#l00424">n_list.c:424</a></div></div>
<div class="ttc" id="struct_n_e_t_w_o_r_k___p_o_o_l_html"><div class="ttname"><a href="struct_n_e_t_w_o_r_k___p_o_o_l.html">NETWORK_POOL</a></div><div class="ttdoc">structure of a network pool </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8h_source.html#l00349">n_network.h:349</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gac345c1af1935cebb9ee33edd4c32267a"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gac345c1af1935cebb9ee33edd4c32267a">netw_close</a></div><div class="ttdeci">int netw_close(NETWORK **netw)</div><div class="ttdoc">Closing a specified Network, destroy queues, free the structure. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01497">n_network.c:1497</a></div></div>
<div class="ttc" id="group___n___s_t_r_html_ga0a864a4ce4997389f2e5e2e16c51a30a"><div class="ttname"><a href="group___n___s_t_r.html#ga0a864a4ce4997389f2e5e2e16c51a30a">free_nstr_ptr</a></div><div class="ttdeci">void free_nstr_ptr(void *ptr)</div><div class="ttdoc">Free a N_STR pointer structure. </div><div class="ttdef"><b>Definition:</b> <a href="n__str_8c_source.html#l00049">n_str.c:49</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_gaeba0ec63ec0aa6803e9a601b645b5cbf"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#gaeba0ec63ec0aa6803e9a601b645b5cbf">read_lock</a></div><div class="ttdeci">#define read_lock(__rwlock_mutex)</div><div class="ttdoc">Macro for acquiring a read lock on a rwlock mutex. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00359">n_common.h:359</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gac8b30599c7a5c2cce35ee401d7b9d7f1"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gac8b30599c7a5c2cce35ee401d7b9d7f1">netw_send_quit</a></div><div class="ttdeci">int netw_send_quit(NETWORK *netw)</div><div class="ttdoc">Add a formatted NETMSG_QUIT message to the specified network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l03168">n_network.c:3168</a></div></div>
<div class="ttc" id="struct_n_e_t_w_o_r_k_html_ac6ee9581baa5e9d738641783c12684c8"><div class="ttname"><a href="struct_n_e_t_w_o_r_k.html#ac6ee9581baa5e9d738641783c12684c8">NETWORK::send_data</a></div><div class="ttdeci">netw_func send_data</div><div class="ttdoc">send func ptr </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8h_source.html#l00303">n_network.h:303</a></div></div>
<div class="ttc" id="struct_n___s_t_r_html"><div class="ttname"><a href="struct_n___s_t_r.html">N_STR</a></div><div class="ttdoc">A box including a string and his lenght. </div><div class="ttdef"><b>Definition:</b> <a href="n__str_8h_source.html#l00150">n_str.h:150</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga22bc4dd5d80c2229c3c43f6d6705dece"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga22bc4dd5d80c2229c3c43f6d6705dece">netw_init_wsa</a></div><div class="ttdeci">int netw_init_wsa(int mode, int v1, int v2)</div><div class="ttdoc">Do not directly use, internal api. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l00752">n_network.c:752</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_ga90d32fef68ce6f3ec0a7b4085690c755"><div class="ttname"><a href="group___l_i_s_t.html#ga90d32fef68ce6f3ec0a7b4085690c755">list_destroy</a></div><div class="ttdeci">int list_destroy(LIST **list)</div><div class="ttdoc">Empty and Free a list container. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8c_source.html#l00480">n_list.c:480</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k___m_s_g_html_ga7f3f5196c913ef29d775d3fbbcaeb476"><div class="ttname"><a href="group___n_e_t_w_o_r_k___m_s_g.html#ga7f3f5196c913ef29d775d3fbbcaeb476">netmsg_make_ping</a></div><div class="ttdeci">N_STR * netmsg_make_ping(int type, int id_from, int id_to, int time)</div><div class="ttdoc">Make a ping message to send to a network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network__msg_8c_source.html#l00575">n_network_msg.c:575</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga55b9404f7bc9d3a3ead2f0103331a87e"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga55b9404f7bc9d3a3ead2f0103331a87e">_str</a></div><div class="ttdeci">#define _str(__PTR)</div><div class="ttdoc">define true </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00169">n_common.h:169</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga9bbd6f2ada0efec0afcdcaa60cc20474"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga9bbd6f2ada0efec0afcdcaa60cc20474">unlock</a></div><div class="ttdeci">#define unlock(__rwlock_mutex)</div><div class="ttdoc">Macro for releasing read/write lock a rwlock mutex. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00391">n_common.h:391</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaa3c12701bdb3cd2e1adaa00981ca3cc8"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaa3c12701bdb3cd2e1adaa00981ca3cc8">netw_send_func</a></div><div class="ttdeci">void * netw_send_func(void *NET)</div><div class="ttdoc">Thread send function. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02189">n_network.c:2189</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k___m_s_g_html_gacbebab8f754ea1a2e225dee3a164e2d8"><div class="ttname"><a href="group___n_e_t_w_o_r_k___m_s_g.html#gacbebab8f754ea1a2e225dee3a164e2d8">netmsg_make_ident</a></div><div class="ttdeci">N_STR * netmsg_make_ident(int type, int id, N_STR *name, N_STR *passwd)</div><div class="ttdoc">Add a formatted NETWMSG_IDENT message to the specified network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network__msg_8c_source.html#l00622">n_network_msg.c:622</a></div></div>
<div class="ttc" id="group___h_a_s_h___t_a_b_l_e_html_ga22a943135dbcdb1611b40ce0547111ce"><div class="ttname"><a href="group___h_a_s_h___t_a_b_l_e.html#ga22a943135dbcdb1611b40ce0547111ce">destroy_ht</a></div><div class="ttdeci">int destroy_ht(HASH_TABLE **table)</div><div class="ttdoc">Free and set the table to NULL. </div><div class="ttdef"><b>Definition:</b> <a href="n__hash_8c_source.html#l01961">n_hash.c:1961</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga45b053eef50f122d73a1c9b094b5a1d7"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga45b053eef50f122d73a1c9b094b5a1d7">netw_accept_nonblock_from</a></div><div class="ttdeci">NETWORK * netw_accept_nonblock_from(NETWORK *from, int blocking)</div><div class="ttdoc">make a normal blocking &amp;#39;accept&amp;#39; . </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01970">n_network.c:1970</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga29159184519b3129c0154b1a2c2a3e2f"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga29159184519b3129c0154b1a2c2a3e2f">netw_stop_thr_engine</a></div><div class="ttdeci">int netw_stop_thr_engine(NETWORK *netw)</div><div class="ttdoc">Stop a NETWORK connection sending and receing thread. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02470">n_network.c:2470</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gae8345266fcf7a23c0e8ffe176b0e086f"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gae8345266fcf7a23c0e8ffe176b0e086f">netw_send_ident</a></div><div class="ttdeci">int netw_send_ident(NETWORK *netw, int type, int id, N_STR *name, N_STR *passwd)</div><div class="ttdoc">Add a formatted NETWMSG_IDENT message to the specified network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l03072">n_network.c:3072</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga4cef67bc400323306a3d1c1ed5cec17b"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga4cef67bc400323306a3d1c1ed5cec17b">netw_connect_ex</a></div><div class="ttdeci">int netw_connect_ex(NETWORK **netw, char *host, char *port, int send_list_limit, int recv_list_limit, int ip_version)</div><div class="ttdoc">Use this to connect a NETWORK to any listening one. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01243">n_network.c:1243</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaf3dc736265484a58e6678c250e38cef8"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaf3dc736265484a58e6678c250e38cef8">send_data</a></div><div class="ttdeci">int send_data(SOCKET s, char *buf, NSTRBYTE n)</div><div class="ttdoc">send data onto the socket </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02513">n_network.c:2513</a></div></div>
<div class="ttc" id="struct_n_e_t_w_o_r_k_html_afa4742a842c0f4e729d8a88371c49209"><div class="ttname"><a href="struct_n_e_t_w_o_r_k.html#afa4742a842c0f4e729d8a88371c49209">NETWORK::recv_data</a></div><div class="ttdeci">netw_func recv_data</div><div class="ttdoc">receive func ptr </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8h_source.html#l00303">n_network.h:303</a></div></div>
<div class="ttc" id="n__network__msg_8h_html"><div class="ttname"><a href="n__network__msg_8h.html">n_network_msg.h</a></div><div class="ttdoc">network messages declaration Network Engine </div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gad67570728a69ce2788b8bc9dcaa7c392"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gad67570728a69ce2788b8bc9dcaa7c392">netw_recv_func</a></div><div class="ttdeci">void * netw_recv_func(void *NET)</div><div class="ttdoc">To Thread Receiving function. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02319">n_network.c:2319</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga68d60dda02e374e8d2e38deb9aecadcd"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga68d60dda02e374e8d2e38deb9aecadcd">rw_lock_destroy</a></div><div class="ttdeci">#define rw_lock_destroy(__rwlock_mutex)</div><div class="ttdoc">Macro to destroy rwlock mutex. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00406">n_common.h:406</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaf25c0f462f174092815b0c5d019441db"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaf25c0f462f174092815b0c5d019441db">netw_get_state</a></div><div class="ttdeci">int netw_get_state(NETWORK *netw, int *state, int *thr_engine_status)</div><div class="ttdoc">Get the state of a network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01393">n_network.c:1393</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga4ecf5d80299a4ca1dc13c3a19610db11"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga4ecf5d80299a4ca1dc13c3a19610db11">__n_assert</a></div><div class="ttdeci">#define __n_assert(__ptr, __ret)</div><div class="ttdoc">macro to assert things </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00260">n_common.h:260</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_gae62e40d702e99a7760ba1de7451dff51"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#gae62e40d702e99a7760ba1de7451dff51">Free</a></div><div class="ttdeci">#define Free(__ptr)</div><div class="ttdoc">Free Handler to get errors. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00240">n_common.h:240</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga079dc7a6a7e7c54bb714d8bb2afdd022"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga079dc7a6a7e7c54bb714d8bb2afdd022">FreeNoLog</a></div><div class="ttdeci">#define FreeNoLog(__ptr)</div><div class="ttdoc">Free Handler without log. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00252">n_common.h:252</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_ga9be40eafc3444fd2443cc940634af163"><div class="ttname"><a href="group___l_i_s_t.html#ga9be40eafc3444fd2443cc940634af163">list_search</a></div><div class="ttdeci">LIST_NODE * list_search(LIST *list, void *ptr)</div><div class="ttdoc">search ptr in list </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8c_source.html#l00385">n_list.c:385</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga10429a9fa106b61c38f28635242ce502"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga10429a9fa106b61c38f28635242ce502">netw_add_msg</a></div><div class="ttdeci">int netw_add_msg(NETWORK *netw, N_STR *msg)</div><div class="ttdoc">Add a message to send in aimed NETWORK. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01982">n_network.c:1982</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gad9588cf27263ecf40f57d3923ccf721a"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gad9588cf27263ecf40f57d3923ccf721a">netw_send_ping</a></div><div class="ttdeci">int netw_send_ping(NETWORK *netw, int type, int id_from, int id_to, int time)</div><div class="ttdoc">Add a ping reply to the network. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l03050">n_network.c:3050</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga7fa831f66b706272d4001e866825e3bf"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga7fa831f66b706272d4001e866825e3bf">netw_wait_msg</a></div><div class="ttdeci">N_STR * netw_wait_msg(NETWORK *netw, long refresh, long timeout)</div><div class="ttdoc">Wait a message from aimed NETWORK. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02085">n_network.c:2085</a></div></div>
<div class="ttc" id="n__network_8c_html_a9caee75e3a67942e37ccb4de2c889105"><div class="ttname"><a href="n__network_8c.html#a9caee75e3a67942e37ccb4de2c889105">netw_new</a></div><div class="ttdeci">NETWORK * netw_new(int send_list_limit, int recv_list_limit)</div><div class="ttdoc">Return an empty allocated network ready to be netw_closed. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l00631">n_network.c:631</a></div></div>
<div class="ttc" id="group___n___s_t_r_html_gab9f1902d941f4f847a1063fd6fedd1f2"><div class="ttname"><a href="group___n___s_t_r.html#gab9f1902d941f4f847a1063fd6fedd1f2">nstrdup</a></div><div class="ttdeci">N_STR * nstrdup(N_STR *str)</div><div class="ttdoc">Duplicate a N_STR. </div><div class="ttdef"><b>Definition:</b> <a href="n__str_8c_source.html#l00746">n_str.c:746</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaea0a4d9c8822d25ed88e6554a88cb996"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaea0a4d9c8822d25ed88e6554a88cb996">netw_accept_from_ex</a></div><div class="ttdeci">NETWORK * netw_accept_from_ex(NETWORK *from, int send_list_limit, int recv_list_limit, int non_blocking, int *retval)</div><div class="ttdoc">make a normal &amp;#39;accept&amp;#39; . </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01810">n_network.c:1810</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga60beb772aa298f36d1443a28e3ec5ec8"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga60beb772aa298f36d1443a28e3ec5ec8">netw_wait_close</a></div><div class="ttdeci">int netw_wait_close(NETWORK **netw)</div><div class="ttdoc">Wait for peer closing a specified Network, destroy queues, free the structure. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01591">n_network.c:1591</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga5ba0555c5ccd261227c3c1216923d563"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga5ba0555c5ccd261227c3c1216923d563">netw_start_thr_engine</a></div><div class="ttdeci">int netw_start_thr_engine(NETWORK *netw)</div><div class="ttdoc">Start the NETWORK netw Threaded Engine. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02149">n_network.c:2149</a></div></div>
<div class="ttc" id="n__hash_8h_html"><div class="ttname"><a href="n__hash_8h.html">n_hash.h</a></div><div class="ttdoc">Hash functions and table. </div></div>
<div class="ttc" id="struct_l_i_s_t___n_o_d_e_html"><div class="ttname"><a href="struct_l_i_s_t___n_o_d_e.html">LIST_NODE</a></div><div class="ttdoc">Structure of a generic list node. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8h_source.html#l00026">n_list.h:26</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_ga366776cfa85e526b247ef1d348c34e0c"><div class="ttname"><a href="group___l_i_s_t.html#ga366776cfa85e526b247ef1d348c34e0c">remove_list_node</a></div><div class="ttdeci">#define remove_list_node(__LIST_,__NODE_, __TYPE_)</div><div class="ttdoc">Remove macro helper for void pointer casting. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8h_source.html#l00083">n_list.h:83</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga7db2f701ab9a20af4a6fa8baac9d5172"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga7db2f701ab9a20af4a6fa8baac9d5172">netw_get_queue_status</a></div><div class="ttdeci">int netw_get_queue_status(NETWORK *netw, int *nb_to_send, int *nb_to_read)</div><div class="ttdoc">retrieve network send queue status </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02850">n_network.c:2850</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gae18d52a130063ba1fd0a4cf4b6a2da20"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gae18d52a130063ba1fd0a4cf4b6a2da20">netw_connect</a></div><div class="ttdeci">int netw_connect(NETWORK **netw, char *host, char *port, int ip_version)</div><div class="ttdoc">Use this to connect a NETWORK to any listening one, unrestricted send/recv lists. ...</div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01378">n_network.c:1378</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga5c0996a0b85b32d296c4e679a6eb86c2"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga5c0996a0b85b32d296c4e679a6eb86c2">netw_destroy_pool</a></div><div class="ttdeci">int netw_destroy_pool(NETWORK_POOL **netw_pool)</div><div class="ttdoc">free a network pool </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02894">n_network.c:2894</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_ga0f3aa54a82aed45e85124acbd7af6a29"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#ga0f3aa54a82aed45e85124acbd7af6a29">send_php</a></div><div class="ttdeci">int send_php(SOCKET s, int _code, char *buf, int n)</div><div class="ttdoc">send data onto the socket </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02621">n_network.c:2621</a></div></div>
<div class="ttc" id="n__network_8c_html_a47e28ca4745f27fc86baf2ce2848d295"><div class="ttname"><a href="n__network_8c.html#a47e28ca4745f27fc86baf2ce2848d295">deplete_send_buffer</a></div><div class="ttdeci">int deplete_send_buffer(int fd, long timeout)</div><div class="ttdoc">wait until the socket is empty or timeout, checking each 100 msec. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01558">n_network.c:1558</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_gaf0e29edead3f943a4ac241c5724e1384"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#gaf0e29edead3f943a4ac241c5724e1384">_nstr</a></div><div class="ttdeci">#define _nstr(__PTR)</div><div class="ttdoc">N_STR or &amp;quot;NULL&amp;quot; string for logging purposes. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00175">n_common.h:175</a></div></div>
<div class="ttc" id="group___l_o_g_html_ga96fad55b3f5adf08c39e4c877cf185e3"><div class="ttname"><a href="group___l_o_g.html#ga96fad55b3f5adf08c39e4c877cf185e3">LOG_ERR</a></div><div class="ttdeci">#define LOG_ERR</div><div class="ttdoc">error conditions </div><div class="ttdef"><b>Definition:</b> <a href="n__log_8h_source.html#l00057">n_log.h:57</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gafd17b2ed695976a31b4cdee5091e0ef7"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gafd17b2ed695976a31b4cdee5091e0ef7">netw_add_msg_ex</a></div><div class="ttdeci">int netw_add_msg_ex(NETWORK *netw, char *str, unsigned int length)</div><div class="ttdoc">Add a message to send in aimed NETWORK. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l02018">n_network.c:2018</a></div></div>
<div class="ttc" id="group___c_o_m_m_o_n_s_html_ga0499ff5244b948781a28466e35282c55"><div class="ttname"><a href="group___c_o_m_m_o_n_s.html#ga0499ff5244b948781a28466e35282c55">init_lock</a></div><div class="ttdeci">#define init_lock(__rwlock_mutex)</div><div class="ttdoc">Macro for initializing a rwlock. </div><div class="ttdef"><b>Definition:</b> <a href="n__common_8h_source.html#l00338">n_common.h:338</a></div></div>
<div class="ttc" id="group___l_o_g_html_ga6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="group___l_o_g.html#ga6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdoc">debug-level messages </div><div class="ttdef"><b>Definition:</b> <a href="n__log_8h_source.html#l00065">n_log.h:65</a></div></div>
<div class="ttc" id="group___h_a_s_h___t_a_b_l_e_html_gaeb031d4f0f896b1802b9c27e62f28d14"><div class="ttname"><a href="group___h_a_s_h___t_a_b_l_e.html#gaeb031d4f0f896b1802b9c27e62f28d14">hash_val</a></div><div class="ttdeci">#define hash_val(node, type)</div><div class="ttdoc">Cast a HASH_NODE element. </div><div class="ttdef"><b>Definition:</b> <a href="n__hash_8h_source.html#l00160">n_hash.h:160</a></div></div>
<div class="ttc" id="group___l_i_s_t_html_ga1109e1a0b5996fb3c362ad243e2f8f80"><div class="ttname"><a href="group___l_i_s_t.html#ga1109e1a0b5996fb3c362ad243e2f8f80">list_shift</a></div><div class="ttdeci">#define list_shift(__LIST_, __TYPE_)</div><div class="ttdoc">Shift macro helper for void pointer casting. </div><div class="ttdef"><b>Definition:</b> <a href="n__list_8h_source.html#l00081">n_list.h:81</a></div></div>
<div class="ttc" id="n__network_8c_html_a4647db7f861fc61c8449577ffe37fe26"><div class="ttname"><a href="n__network_8c.html#a4647db7f861fc61c8449577ffe37fe26">N_ENUM_DEFINE</a></div><div class="ttdeci">N_ENUM_DEFINE(N_ENUM_netw_code_type, __netw_code_type)</div><div class="ttdoc">Keep it compatible with bsd like. </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l00020">n_network.c:20</a></div></div>
<div class="ttc" id="group___h_a_s_h___t_a_b_l_e_html_ga072f117e6bd9fdde0d39776764b8784e"><div class="ttname"><a href="group___h_a_s_h___t_a_b_l_e.html#ga072f117e6bd9fdde0d39776764b8784e">ht_foreach</a></div><div class="ttdeci">#define ht_foreach(__ITEM_, __HASH_)</div><div class="ttdoc">ForEach macro helper (classic / old) </div><div class="ttdef"><b>Definition:</b> <a href="n__hash_8h_source.html#l00167">n_hash.h:167</a></div></div>
<div class="ttc" id="group___n_e_t_w_o_r_k_i_n_g_html_gaf21b84460e80c7853bcb8321d7c53065"><div class="ttname"><a href="group___n_e_t_w_o_r_k_i_n_g.html#gaf21b84460e80c7853bcb8321d7c53065">netw_accept_from</a></div><div class="ttdeci">NETWORK * netw_accept_from(NETWORK *from)</div><div class="ttdoc">make a normal blocking &amp;#39;accept&amp;#39; . </div><div class="ttdef"><b>Definition:</b> <a href="n__network_8c_source.html#l01957">n_network.c:1957</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="n__network_8c.html">n_network.c</a></li>
    <li class="footer">Generated on Tue Feb 1 2022 16:48:22 for Nilorea Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
